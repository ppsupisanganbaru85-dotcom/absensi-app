<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kehadiran Karyawan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .input-focus:focus { box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            /* Container and layout */
            .container {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
            
            /* Header responsive */
            .gradient-bg {
                padding-top: 1.5rem !important;
                padding-bottom: 1.5rem !important;
            }
            
            .gradient-bg h1 {
                font-size: 1.25rem !important;
                line-height: 1.75rem !important;
            }
            
            /* Navigation buttons */
            .nav-buttons {
                flex-direction: column !important;
                gap: 0.75rem !important;
                padding: 0 !important;
            }
            
            .nav-buttons button {
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
                min-height: 44px !important;
            }
            
            /* Form responsive */
            .form-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* Card responsive */
            .card-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* Table responsive */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                border-radius: 0.75rem;
            }
            
            .table-container table {
                min-width: 800px;
            }
            
            .table-container th,
            .table-container td {
                padding: 0.5rem 0.375rem !important;
                font-size: 0.75rem !important;
                white-space: nowrap;
            }
            
            .table-container th {
                font-size: 0.625rem !important;
                font-weight: 600 !important;
            }
            
            /* Camera responsive */
            .camera-container {
                max-width: 100%;
            }
            
            .camera-container .grid {
                grid-template-columns: 1fr 1fr !important;
                gap: 0.5rem !important;
            }
            
            .camera-container button {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.75rem !important;
                min-height: 40px !important;
            }
            
            #cameraVideo {
                height: 200px !important;
                border-radius: 0.5rem !important;
            }
            
            #photoPreview {
                height: 200px !important;
                border-radius: 0.5rem !important;
            }
            
            /* Modal responsive */
            .modal-content {
                margin: 1rem !important;
                max-height: calc(100vh - 2rem) !important;
                overflow-y: auto;
                border-radius: 0.75rem !important;
            }
            
            /* Button responsive */
            .btn-responsive {
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
                min-height: 44px !important;
            }
            
            /* Summary cards responsive */
            .summary-grid {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
            }
            
            .summary-grid > div {
                padding: 1rem 0.75rem !important;
            }
            
            .summary-grid .text-2xl {
                font-size: 1.5rem !important;
            }
            
            .summary-grid .text-sm {
                font-size: 0.75rem !important;
            }
            
            /* Dashboard view toggle */
            .dashboard-toggle {
                flex-direction: column !important;
                gap: 0.75rem !important;
            }
            
            .dashboard-toggle button {
                width: 100% !important;
                justify-content: center !important;
            }
            
            /* Active sessions */
            .active-sessions-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }
            
            /* Time display */
            #currentTime {
                font-size: 2rem !important;
            }
            
            #currentDate {
                font-size: 1rem !important;
            }
            
            /* Card content responsive */
            .card-content {
                padding: 1rem !important;
            }
            
            .card-content h3 {
                font-size: 1rem !important;
            }
            
            .card-content .grid {
                gap: 0.75rem !important;
            }
            
            .card-content .text-sm {
                font-size: 0.75rem !important;
            }
            
            /* Input fields */
            input, select, textarea {
                padding: 0.75rem !important;
                font-size: 1rem !important;
                min-height: 44px !important;
            }
            
            /* Labels */
            label {
                font-size: 0.875rem !important;
                margin-bottom: 0.5rem !important;
            }
        }
        
        /* Extra small screens */
        @media (max-width: 480px) {
            .container {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
            
            .gradient-bg h1 {
                font-size: 1.125rem !important;
            }
            
            #currentTime {
                font-size: 1.75rem !important;
            }
            
            .summary-grid .text-2xl {
                font-size: 1.25rem !important;
            }
            
            .card-content {
                padding: 0.75rem !important;
            }
        }
        
        /* Touch-friendly buttons */
        @media (hover: none) and (pointer: coarse) {
            button, .btn {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Smooth transitions */
        * {
            transition: all 0.2s ease-in-out;
        }
        
        /* Custom scrollbar for mobile */
        .custom-scroll::-webkit-scrollbar {
            height: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 2px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        
        /* Table responsive improvements */
        @media (max-width: 768px) {
            .table-container table {
                min-width: 800px;
            }
            
            .table-container th,
            .table-container td {
                padding: 8px 6px !important;
                font-size: 12px !important;
            }
            
            .table-container th {
                font-size: 10px !important;
                white-space: nowrap;
            }
        }
        
        /* Loading animation */
        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        
        /* Status indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-success { background-color: #dcfce7; color: #166534; }
        .status-warning { background-color: #fef3c7; color: #92400e; }
        .status-error { background-color: #fee2e2; color: #991b1b; }
        .status-info { background-color: #dbeafe; color: #1e40af; }

        /* Notification styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease-in-out;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success { background-color: #10b981; }
        .notification.error { background-color: #ef4444; }
        .notification.info { background-color: #3b82f6; }
        .notification.warning { background-color: #f59e0b; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Header -->
    <div class="gradient-bg text-white py-6 sm:py-8">
        <div class="container mx-auto px-4">
            <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-center">üìä Absensi PPSU Pisangan Baru</h1>
            
            <!-- Navigation -->
            <div class="flex flex-col sm:flex-row justify-center mt-4 sm:mt-6 gap-3 sm:gap-4 nav-buttons px-2 sm:px-4">
                <button onclick="showPage('realtime')" id="realtimeBtn" class="bg-white bg-opacity-30 hover:bg-opacity-40 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 btn-responsive w-full sm:w-auto">
                    <span>üïê</span> 
                    <span class="hidden sm:inline">Absensi Real-Time</span>
                    <span class="sm:hidden">Real-Time</span>
                </button>
                <button onclick="showPage('manual')" id="manualBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 btn-responsive w-full sm:w-auto">
                    <span>üë®‚Äçüíº</span> 
                    <span class="hidden sm:inline">Panel Admin</span>
                    <span class="sm:hidden">Admin</span>
                </button>
                <button onclick="logout()" id="logoutBtn" class="bg-red-500 bg-opacity-80 hover:bg-opacity-100 text-white px-4 py-3 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 btn-responsive w-full sm:w-auto hidden">
                    <span>üö™</span> 
                    <span class="hidden sm:inline">Logout</span>
                    <span class="sm:hidden">Keluar</span>
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8">
        <!-- Real-Time Attendance Page -->
        <div id="realtimePage" class="hidden">
            <!-- Current Time Display -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-8 text-center">
                <h2 class="text-2xl font-semibold mb-4 text-gray-800">üïê Absensi Real-Time</h2>
                <div class="text-4xl font-bold text-indigo-600 mb-2" id="currentTime">00:00:00</div>
                <div class="text-lg text-gray-600" id="currentDate">Loading...</div>
            </div>

            <!-- Quick Attendance Form -->
            <div class="bg-white rounded-xl card-shadow card-content mb-8">
                <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-gray-800">‚ö° Absen Cepat</h3>
                <form id="quickAttendanceForm" class="form-grid grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Karyawan</label>
                        <input type="text" id="quickEmployeeName" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Masukkan nama" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Shift</label>
                        <select id="quickShiftSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                            <option value="">Pilih Shift</option>
                            <option value="shift1">Shift 1 (05:00-13:00)</option>
                            <option value="shift2">Shift 2 (07:20-15:20)</option>
                            <option value="kantor">Shift Kantor (07:00-17:00)</option>
                            <option value="piket1">Shift Piket 1 (18:00-06:00)</option>
                            <option value="piket_pagi">Shift Piket Kantor Pagi (07:00-12:00)</option>
                            <option value="piket_siang">Shift Piket Kantor Siang (12:00-17:00)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jenis Absen</label>
                        <select id="attendanceType" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                            <option value="">Pilih Jenis</option>
                            <option value="masuk">Absen Masuk</option>
                            <option value="keluar">Absen Keluar</option>
                        </select>
                    </div>
                    <div class="sm:col-span-2 xl:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Foto Absensi</label>
                        <div class="space-y-3 camera-container">
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" onclick="openCamera()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-1 btn-responsive text-sm">
                                    <span>üì∑</span> 
                                    <span class="hidden sm:inline">Kamera</span>
                                    <span class="sm:hidden">üì∑</span>
                                </button>
                                <button type="button" onclick="showFileInput()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-1 btn-responsive text-sm">
                                    <span>üìÅ</span> 
                                    <span class="hidden sm:inline">Upload</span>
                                    <span class="sm:hidden">üìÅ</span>
                                </button>
                            </div>

                            <input type="file" id="photoFileInput" accept="image/*" capture="environment" class="hidden" onchange="handleFileSelect(event)">
                            <div id="cameraPreview" class="hidden">
                                <video id="cameraVideo" class="w-full h-40 sm:h-48 bg-gray-100 rounded-lg object-cover" autoplay playsinline></video>
                                <div class="flex gap-2 mt-2 mobile-gap-2">
                                    <button type="button" onclick="capturePhoto()" class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium text-sm btn-responsive">
                                        <span class="hidden sm:inline">üì∏ Ambil</span>
                                        <span class="sm:hidden">üì∏</span>
                                    </button>
                                    <button type="button" onclick="closeCamera()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 rounded-lg font-medium text-sm btn-responsive">
                                        <span class="hidden sm:inline">‚ùå Batal</span>
                                        <span class="sm:hidden">‚ùå</span>
                                    </button>
                                </div>
                            </div>
                            <div id="capturedPhoto" class="hidden">
                                <img id="photoPreview" class="w-full h-40 sm:h-48 bg-gray-100 rounded-lg object-cover" alt="Foto Absensi">
                                <div class="flex gap-2 mt-2 mobile-gap-2">
                                    <button type="button" onclick="retakePhoto()" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg font-medium text-sm btn-responsive">
                                        <span class="hidden sm:inline">üîÑ Ulang</span>
                                        <span class="sm:hidden">üîÑ</span>
                                    </button>
                                    <button type="button" onclick="removePhoto()" class="flex-1 bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg font-medium text-sm btn-responsive">
                                        <span class="hidden sm:inline">üóëÔ∏è Hapus</span>
                                        <span class="sm:hidden">üóëÔ∏è</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan</label>
                        <input type="text" id="quickNotes" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Catatan tambahan (opsional)">
                    </div>
                    <div class="sm:col-span-2 lg:col-span-4">
                        <button type="submit" class="w-full sm:w-auto bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2 text-base sm:text-lg btn-responsive">
                            <span>‚ö°</span> 
                            <span class="hidden sm:inline">Absen Sekarang</span>
                            <span class="sm:hidden">Absen</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- Active Sessions -->
            <div class="bg-white rounded-xl card-shadow card-content mb-8">
                <h3 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-gray-800">üë• Sesi Aktif Hari Ini</h3>
                <div id="activeSessions" class="active-sessions-grid grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                    <!-- Active sessions akan ditampilkan di sini -->
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-xl p-6 w-full max-w-md">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">üîê Login Admin</h3>
                    <p class="text-gray-600">Masukkan kredensial untuk mengakses Panel Admin</p>
                </div>
                <form id="loginForm">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Masukkan username" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Masukkan password" required>
                    </div>
                    <div class="flex gap-3">
                        <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded-lg font-medium transition-colors duration-200">
                            üîì Login
                        </button>
                        <button type="button" onclick="closeLoginModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-medium transition-colors duration-200">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manual Input Page -->
        <div id="manualPage" class="hidden">
            <!-- Manual Input Content -->
            <div id="manualContent" class="hidden">
                <!-- Form Input -->
                <div class="bg-white rounded-xl card-shadow card-content mb-8">
                    <h2 class="text-lg sm:text-xl font-semibold mb-4 sm:mb-6 text-gray-800">üìù Input Data Kehadiran</h2>
                    <form id="attendanceForm" class="form-grid grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nama Karyawan</label>
                            <input type="text" id="employeeName" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Masukkan nama" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Hari</label>
                            <select id="dayOfWeek" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                                <option value="">Pilih Hari</option>
                                <option value="Senin">Senin</option>
                                <option value="Selasa">Selasa</option>
                                <option value="Rabu">Rabu</option>
                                <option value="Kamis">Kamis</option>
                                <option value="Jumat">Jumat</option>
                                <option value="Sabtu">Sabtu</option>
                                <option value="Minggu">Minggu</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                            <input type="date" id="attendanceDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Shift</label>
                            <select id="shiftSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                                <option value="">Pilih Shift</option>
                                <option value="shift1">Shift 1 (05:00-13:00)</option>
                                <option value="shift2">Shift 2 (07:20-15:20)</option>
                                <option value="kantor">Shift Kantor (07:00-17:00)</option>
                                <option value="piket1">Shift Piket 1 (18:00-06:00)</option>
                                <option value="piket_pagi">Shift Piket Kantor Pagi (07:00-12:00)</option>
                                <option value="piket_siang">Shift Piket Kantor Siang (12:00-17:00)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jam Kerja Mulai</label>
                            <input type="time" id="workStart" value="07:00" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jam Kerja Selesai</label>
                            <input type="time" id="workEnd" value="17:00" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" readonly>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jam Masuk</label>
                            <input type="time" id="timeIn" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Jam Keluar</label>
                            <input type="time" id="timeOut" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                        </div>
                        <div class="md:col-span-2 xl:col-span-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Catatan</label>
                            <input type="text" id="notes" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Catatan tambahan (opsional)">
                        </div>
                        <div class="md:col-span-2 xl:col-span-3">
                            <button type="submit" class="w-full sm:w-auto bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2">
                                <span>‚ûï</span> Tambah Data
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Rekap Summary -->
                <div class="summary-grid grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-8">
                    <div class="bg-red-50 border border-red-200 rounded-xl p-4 text-center">
                        <div class="text-red-600 text-2xl font-bold" id="totalLate">0</div>
                        <div class="text-red-700 text-sm font-medium">Total Jam Terlambat</div>
                    </div>
                    <div class="bg-orange-50 border border-orange-200 rounded-xl p-4 text-center">
                        <div class="text-orange-600 text-2xl font-bold" id="totalEarly">0</div>
                        <div class="text-orange-700 text-sm font-medium">Total Cepat Pulang</div>
                    </div>
                    <div class="bg-green-50 border border-green-200 rounded-xl p-4 text-center">
                        <div class="text-green-600 text-2xl font-bold" id="totalEffective">0</div>
                        <div class="text-green-700 text-sm font-medium">Rata-rata Jam Efektif</div>
                    </div>
                    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 text-center">
                        <div class="text-blue-600 text-2xl font-bold" id="totalOvertime">0</div>
                        <div class="text-blue-700 text-sm font-medium">Total Lembur</div>
                    </div>
                </div>

                <!-- Dashboard Data Kehadiran -->
                <div class="bg-white rounded-xl card-shadow card-content mb-8">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 gap-4">
                        <h2 class="text-lg sm:text-xl font-semibold text-gray-800">üìä Dashboard Data Kehadiran</h2>
                        <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto dashboard-toggle">
                            <button onclick="toggleView('cards')" id="cardViewBtn" class="flex-1 sm:flex-none bg-indigo-600 text-white px-3 py-2 rounded-lg text-sm font-medium btn-responsive min-h-[44px] flex items-center justify-center">
                                üìã <span class="ml-1">Tampilan Kartu</span>
                            </button>
                            <button onclick="toggleView('table')" id="tableViewBtn" class="flex-1 sm:flex-none bg-gray-300 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium btn-responsive min-h-[44px] flex items-center justify-center">
                                üìä <span class="ml-1">Tampilan Tabel</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Card View Dashboard -->
                    <div id="cardView" class="card-grid grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
                        <!-- Cards akan ditambahkan di sini -->
                    </div>
                </div>

                <!-- Tabel Data -->
                <div id="tableView" class="bg-white rounded-xl card-shadow overflow-hidden" style="display: none;">
                    <div class="px-4 sm:px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg sm:text-xl font-semibold text-gray-800">üìã Data Kehadiran</h2>
                    </div>
                    <div class="table-container overflow-x-auto custom-scroll">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Shift</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hari</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jam Kerja</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jam Masuk</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jam Keluar</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Telat</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cepat Pulang</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jam Efektif</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Lembur</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Foto</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Catatan</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTable" class="bg-white divide-y divide-gray-200">
                                <!-- Data akan ditambahkan di sini -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Export Button -->
                <div class="mt-8 px-4">
                    <div class="flex justify-center">
                        <button onclick="exportToCSV()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2 btn-responsive">
                            <span>üìä</span> 
                            <span>Export ke Excel</span>
                        </button>
                    </div>
                </div>

                <!-- Keterangan Warna -->
                <div class="mt-8 bg-white rounded-xl card-shadow p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg font-semibold mb-4 text-gray-800">üìã Keterangan Indikator Warna</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="bg-red-100 text-red-800 px-2 sm:px-3 py-1 rounded font-medium text-xs sm:text-sm">Merah</div>
                            <span class="text-xs sm:text-sm text-gray-600">Terlambat masuk kerja</span>
                        </div>
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="bg-orange-100 text-orange-800 px-2 sm:px-3 py-1 rounded font-medium text-xs sm:text-sm">Orange</div>
                            <span class="text-xs sm:text-sm text-gray-600">Cepat pulang dari kerja</span>
                        </div>
                        <div class="flex items-center gap-2 sm:gap-3">
                            <div class="bg-yellow-100 text-yellow-800 px-2 sm:px-3 py-1 rounded font-medium text-xs sm:text-sm">Kuning</div>
                            <span class="text-xs sm:text-sm text-gray-600">Jam kerja kurang dari standar</span>
                        </div>
                    </div>
                </div>
            </div> <!-- End manualContent -->
        </div> <!-- End manualPage -->

        <!-- Edit Modal -->
        <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-xl p-4 sm:p-6 w-full max-w-2xl max-h-screen overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-gray-800">‚úèÔ∏è Edit Data Kehadiran</h3>
                    <button onclick="closeEditModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <form id="editForm" class="form-grid grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="hidden" id="editId">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Karyawan</label>
                        <input type="text" id="editEmployeeName" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Hari</label>
                        <select id="editDayOfWeek" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                            <option value="">Pilih Hari</option>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                            <option value="Sabtu">Sabtu</option>
                            <option value="Minggu">Minggu</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tanggal</label>
                        <input type="date" id="editAttendanceDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Shift</label>
                        <select id="editShiftSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                            <option value="">Pilih Shift</option>
                            <option value="shift1">Shift 1 (05:00-13:00)</option>
                            <option value="shift2">Shift 2 (07:20-15:20)</option>
                            <option value="kantor">Shift Kantor (07:00-17:00)</option>
                            <option value="piket1">Shift Piket 1 (18:00-06:00)</option>
                            <option value="piket_pagi">Shift Piket Kantor Pagi (07:00-12:00)</option>
                            <option value="piket_siang">Shift Piket Kantor Siang (12:00-17:00)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jam Kerja Mulai</label>
                        <input type="time" id="editWorkStart" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jam Kerja Selesai</label>
                        <input type="time" id="editWorkEnd" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jam Masuk</label>
                        <input type="time" id="editTimeIn" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jam Keluar</label>
                        <input type="time" id="editTimeOut" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Catatan</label>
                        <input type="text" id="editNotes" class="w-full px-3 py-2 border border-gray-300 rounded-lg input-focus focus:outline-none focus:border-indigo-500" placeholder="Catatan tambahan (opsional)">
                    </div>
                    <div class="sm:col-span-2 flex flex-col sm:flex-row gap-3 sm:gap-4">
                        <button type="submit" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2 btn-responsive">
                            <span>üíæ</span> 
                            <span class="hidden sm:inline">Simpan Perubahan</span>
                            <span class="sm:hidden">Simpan</span>
                        </button>
                        <button type="button" onclick="closeEditModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg font-medium transition-colors duration-200 btn-responsive">
                            Batal
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Photo Modal -->
        <div id="photoModal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center p-4">
            <div class="modal-content bg-white rounded-xl p-4 max-w-2xl w-full max-h-screen overflow-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">üì∑ Foto Absensi</h3>
                    <button onclick="closePhotoModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>
                <img id="modalPhoto" src="" alt="Foto Absensi" class="w-full max-h-96 object-contain rounded-lg">
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-4 sm:py-6 mt-8 sm:mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-base sm:text-lg font-semibold">eLfidaChannel</p>
            <p class="text-xs sm:text-sm text-gray-400 mt-1">Sistem Input Absensi PPSU</p>
        </div>
    </footer>

    <script>
        let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
        let activeSessions = JSON.parse(localStorage.getItem('activeSessions')) || [];
        let currentPage = 'realtime';
        let currentStream = null;
        let capturedPhotoData = null;
        let isLoggedIn = JSON.parse(localStorage.getItem('isLoggedIn')) || false;

        // Login credentials
        const ADMIN_USERNAME = 'elfida';
        const ADMIN_PASSWORD = 'Pis212baru';

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Login functions
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        function logout() {
            isLoggedIn = false;
            localStorage.setItem('isLoggedIn', JSON.stringify(false));
            document.getElementById('manualContent').classList.add('hidden');
            document.getElementById('logoutBtn').classList.add('hidden');
            showPage('realtime');
            showNotification('Berhasil logout!', 'info');
        }

        // Handle login form
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                localStorage.setItem('isLoggedIn', JSON.stringify(true));
                closeLoginModal();
                document.getElementById('manualContent').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                showNotification('Login berhasil! Selamat datang Admin.', 'success');
                
                // Load data after successful login
                setTimeout(() => {
                    renderTable();
                    renderDashboard();
                    updateSummary();
                }, 100);
            } else {
                showNotification('Username atau password salah!', 'error');
            }
        });

        // Camera functions with enhanced compatibility
        async function openCamera() {
            try {
                // Show loading state
                showNotification('Membuka kamera...', 'info');
                
                // Check browser support
                if (!navigator.mediaDevices) {
                    throw new Error('MediaDevices not supported');
                }

                // Get available devices first
                let devices = [];
                try {
                    devices = await navigator.mediaDevices.enumerateDevices();
                    console.log('Available devices:', devices);
                } catch (e) {
                    console.log('Cannot enumerate devices:', e);
                }

                // Try different camera configurations with more options
                let stream = null;
                const constraints = [
                    // Try environment camera (back camera) - best for attendance
                    { 
                        video: { 
                            facingMode: { exact: 'environment' },
                            width: { min: 320, ideal: 640, max: 1920 },
                            height: { min: 240, ideal: 480, max: 1080 }
                        } 
                    },
                    // Try environment camera without exact
                    { 
                        video: { 
                            facingMode: 'environment',
                            width: { min: 320, ideal: 640, max: 1280 },
                            height: { min: 240, ideal: 480, max: 720 }
                        } 
                    },
                    // Try user camera (front camera)
                    { 
                        video: { 
                            facingMode: 'user',
                            width: { min: 320, ideal: 640, max: 1280 },
                            height: { min: 240, ideal: 480, max: 720 }
                        } 
                    },
                    // Try any camera with ideal settings
                    { 
                        video: { 
                            width: { min: 320, ideal: 640, max: 1280 },
                            height: { min: 240, ideal: 480, max: 720 }
                        } 
                    },
                    // Try with minimal constraints
                    { 
                        video: { 
                            width: { min: 320 },
                            height: { min: 240 }
                        } 
                    },
                    // Basic fallback - any video
                    { video: true },
                    // Last resort - very basic
                    { video: { width: 320, height: 240 } }
                ];

                let lastError = null;
                for (let i = 0; i < constraints.length; i++) {
                    try {
                        console.log(`Trying constraint ${i + 1}:`, constraints[i]);
                        stream = await navigator.mediaDevices.getUserMedia(constraints[i]);
                        console.log('Success with constraint:', constraints[i]);
                        break;
                    } catch (err) {
                        console.log(`Constraint ${i + 1} failed:`, err);
                        lastError = err;
                        
                        // Wait a bit before trying next constraint
                        await new Promise(resolve => setTimeout(resolve, 100));
                        continue;
                    }
                }

                if (!stream) {
                    throw lastError || new Error('No camera configuration worked');
                }
                
                currentStream = stream;
                const video = document.getElementById('cameraVideo');
                
                // Set video properties
                video.srcObject = stream;
                video.setAttribute('playsinline', true);
                video.setAttribute('autoplay', true);
                video.setAttribute('muted', true);
                
                // Enhanced video loading
                return new Promise((resolve, reject) => {
                    const timeout = setTimeout(() => {
                        reject(new Error('Video loading timeout'));
                    }, 10000); // 10 second timeout
                    
                    video.onloadedmetadata = async () => {
                        clearTimeout(timeout);
                        try {
                            await video.play();
                            
                            // Show camera preview
                            document.getElementById('cameraPreview').classList.remove('hidden');
                            document.getElementById('capturedPhoto').classList.add('hidden');
                            
                            // Get video track info
                            const videoTrack = stream.getVideoTracks()[0];
                            const settings = videoTrack.getSettings();
                            console.log('Camera settings:', settings);
                            
                            showNotification(`Kamera berhasil dibuka! (${settings.width}x${settings.height})`, 'success');
                            resolve();
                        } catch (playError) {
                            console.error('Video play error:', playError);
                            reject(playError);
                        }
                    };
                    
                    video.onerror = (e) => {
                        clearTimeout(timeout);
                        console.error('Video error:', e);
                        reject(new Error('Video loading failed'));
                    };
                    
                    // Fallback: try to play after a short delay
                    setTimeout(async () => {
                        if (video.readyState >= 2) { // HAVE_CURRENT_DATA
                            try {
                                await video.play();
                                clearTimeout(timeout);
                                document.getElementById('cameraPreview').classList.remove('hidden');
                                document.getElementById('capturedPhoto').classList.add('hidden');
                                showNotification('Kamera berhasil dibuka!', 'success');
                                resolve();
                            } catch (e) {
                                console.log('Fallback play failed:', e);
                            }
                        }
                    }, 1000);
                });
                
            } catch (error) {
                console.error('Camera error details:', error);
                
                // Close any existing stream
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                    currentStream = null;
                }
                
                let errorMessage = 'Gagal mengakses kamera. ';
                let troubleshootingTips = [];
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    errorMessage += 'Izin kamera ditolak.';
                    troubleshootingTips = [
                        '1. Klik ikon kamera di address bar browser',
                        '2. Pilih "Allow" atau "Izinkan"',
                        '3. Refresh halaman dan coba lagi',
                        '4. Periksa pengaturan browser untuk izin kamera'
                    ];
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    errorMessage += 'Kamera tidak ditemukan.';
                    troubleshootingTips = [
                        '1. Pastikan kamera terpasang dan berfungsi',
                        '2. Tutup aplikasi lain yang menggunakan kamera',
                        '3. Restart browser atau perangkat',
                        '4. Gunakan tombol Upload sebagai alternatif'
                    ];
                } else if (error.name === 'NotSupportedError' || error.name === 'NotReadableError') {
                    errorMessage += 'Kamera tidak dapat diakses.';
                    troubleshootingTips = [
                        '1. Kamera mungkin sedang digunakan aplikasi lain',
                        '2. Restart browser',
                        '3. Periksa driver kamera',
                        '4. Gunakan browser yang berbeda (Chrome/Firefox)'
                    ];
                } else if (error.name === 'OverconstrainedError' || error.name === 'ConstraintNotSatisfiedError') {
                    errorMessage += 'Konfigurasi kamera tidak didukung.';
                    troubleshootingTips = [
                        '1. Kamera tidak mendukung resolusi yang diminta',
                        '2. Coba gunakan browser yang berbeda',
                        '3. Update driver kamera',
                        '4. Gunakan tombol Upload sebagai alternatif'
                    ];
                } else if (error.message === 'Video loading timeout') {
                    errorMessage += 'Kamera terlalu lama loading.';
                    troubleshootingTips = [
                        '1. Koneksi internet mungkin lambat',
                        '2. Restart browser dan coba lagi',
                        '3. Tutup tab browser yang tidak perlu',
                        '4. Gunakan tombol Upload sebagai alternatif'
                    ];
                } else {
                    errorMessage += 'Error tidak dikenal.';
                    troubleshootingTips = [
                        '1. Refresh halaman dan coba lagi',
                        '2. Gunakan browser Chrome atau Firefox',
                        '3. Pastikan menggunakan HTTPS atau localhost',
                        '4. Gunakan tombol Upload sebagai alternatif'
                    ];
                }
                
                // Show detailed error with troubleshooting
                showCameraError(errorMessage, troubleshootingTips);
                
                // Auto-show file input as fallback
                setTimeout(() => {
                    showFileInputFallback();
                }, 2000);
            }
        }

        // Enhanced error display function
        function showCameraError(message, tips) {
            showNotification(message, 'error');
            
            // Show detailed troubleshooting in console
            console.log('üì∑ TROUBLESHOOTING KAMERA:');
            console.log(message);
            tips.forEach(tip => console.log(tip));
            
            // Show tips in UI
            const container = document.querySelector('.camera-container');
            if (container && !container.querySelector('.error-tips')) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-tips mt-3 p-3 bg-red-50 border border-red-200 rounded-lg';
                errorDiv.innerHTML = `
                    <p class="text-sm text-red-800 font-medium mb-2">‚ùå ${message}</p>
                    <div class="text-xs text-red-700">
                        <p class="font-medium mb-1">Solusi:</p>
                        ${tips.map(tip => `<p class="mb-1">${tip}</p>`).join('')}
                    </div>
                    <button onclick="this.parentElement.remove()" class="mt-2 text-xs text-red-600 hover:text-red-800 underline">
                        Tutup pesan ini
                    </button>
                `;
                container.appendChild(errorDiv);
            }
        }



        // File input functions
        function showFileInput() {
            document.getElementById('photoFileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        capturedPhotoData = e.target.result;
                        const preview = document.getElementById('photoPreview');
                        preview.src = capturedPhotoData;
                        
                        document.getElementById('cameraPreview').classList.add('hidden');
                        document.getElementById('capturedPhoto').classList.remove('hidden');
                        
                        showNotification('Foto berhasil dipilih!', 'success');
                    };
                    reader.readAsDataURL(file);
                } else {
                    showNotification('File harus berupa gambar!', 'error');
                }
            }
        }

        function showFileInputFallback() {
            // Show alternative file input method
            const container = document.querySelector('.camera-container');
            if (container && !container.querySelector('.fallback-input')) {
                const fallbackDiv = document.createElement('div');
                fallbackDiv.className = 'fallback-input mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg';
                fallbackDiv.innerHTML = `
                    <p class="text-sm text-yellow-800 mb-2">üì± Kamera tidak tersedia. Gunakan opsi upload foto:</p>
                    <button type="button" onclick="showFileInput()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors duration-200 flex items-center justify-center gap-2">
                        <span>üìÅ</span> Pilih Foto dari Galeri
                    </button>
                `;
                container.appendChild(fallbackDiv);
            }
        }

        function closeCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            document.getElementById('cameraPreview').classList.add('hidden');
        }

        function capturePhoto() {
            const video = document.getElementById('cameraVideo');
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            capturedPhotoData = canvas.toDataURL('image/jpeg', 0.8);
            
            const preview = document.getElementById('photoPreview');
            preview.src = capturedPhotoData;
            
            document.getElementById('cameraPreview').classList.add('hidden');
            document.getElementById('capturedPhoto').classList.remove('hidden');
            
            closeCamera();
            showNotification('Foto berhasil diambil!', 'success');
        }

        function retakePhoto() {
            capturedPhotoData = null;
            document.getElementById('capturedPhoto').classList.add('hidden');
            openCamera();
        }

        function removePhoto() {
            capturedPhotoData = null;
            document.getElementById('capturedPhoto').classList.add('hidden');
            showNotification('Foto dihapus!', 'info');
        }

        function showPhotoModal(photoSrc) {
            document.getElementById('modalPhoto').src = photoSrc;
            document.getElementById('photoModal').classList.remove('hidden');
        }

        function closePhotoModal() {
            document.getElementById('photoModal').classList.add('hidden');
        }

        // Page navigation
        function showPage(page) {
            const realtimePage = document.getElementById('realtimePage');
            const manualPage = document.getElementById('manualPage');
            const realtimeBtn = document.getElementById('realtimeBtn');
            const manualBtn = document.getElementById('manualBtn');

            if (page === 'realtime') {
                realtimePage.classList.remove('hidden');
                manualPage.classList.add('hidden');
                realtimeBtn.classList.add('bg-white', 'bg-opacity-30');
                realtimeBtn.classList.remove('bg-opacity-20');
                manualBtn.classList.remove('bg-white', 'bg-opacity-30');
                manualBtn.classList.add('bg-opacity-20');
                currentPage = 'realtime';
                startClock();
                renderActiveSessions();
            } else {
                if (!isLoggedIn) {
                    showLoginModal();
                    return;
                }
                
                realtimePage.classList.add('hidden');
                manualPage.classList.remove('hidden');
                document.getElementById('manualContent').classList.remove('hidden');
                manualBtn.classList.add('bg-white', 'bg-opacity-30');
                manualBtn.classList.remove('bg-opacity-20');
                realtimeBtn.classList.remove('bg-white', 'bg-opacity-30');
                realtimeBtn.classList.add('bg-opacity-20');
                currentPage = 'manual';
                stopClock();
                
                // Force complete refresh of manual page data
                setTimeout(() => {
                    renderTable();
                    renderDashboard();
                    updateSummary();
                }, 50);
            }
        }

        // Real-time clock
        let clockInterval;
        
        function startClock() {
            updateClock();
            clockInterval = setInterval(updateClock, 1000);
        }

        function stopClock() {
            if (clockInterval) {
                clearInterval(clockInterval);
            }
        }

        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('id-ID');
            const dateString = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
        }

        // Quick attendance form handler
        document.getElementById('quickAttendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('quickEmployeeName').value;
            const shiftType = document.getElementById('quickShiftSelect').value;
            const attendanceType = document.getElementById('attendanceType').value;
            const notes = document.getElementById('quickNotes').value;
            
            if (!shiftType || !attendanceType) {
                showNotification('Pilih shift dan jenis absen terlebih dahulu!', 'warning');
                return;
            }

            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5);
            const currentDate = now.toISOString().split('T')[0];
            const currentDay = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'][now.getDay()];

            // Get shift work hours
            const shifts = {
                'shift1': { start: '05:00', end: '13:00' },
                'shift2': { start: '07:20', end: '15:20' },
                'kantor': { start: '07:00', end: '17:00' },
                'piket1': { start: '18:00', end: '06:00' },
                'piket_pagi': { start: '07:00', end: '12:00' },
                'piket_siang': { start: '12:00', end: '17:00' }
            };

            const workStart = shifts[shiftType].start;
            const workEnd = shifts[shiftType].end;

            if (attendanceType === 'masuk') {
                // Check if there's already an active session for this person today
                const existingSession = activeSessions.find(session => 
                    session.name === name && 
                    session.date === currentDate && 
                    session.shiftType === shiftType &&
                    !session.timeOut
                );

                if (existingSession) {
                    showNotification('Sudah ada sesi aktif untuk karyawan ini hari ini!', 'warning');
                    return;
                }

                // Create new active session
                const newSession = {
                    id: Date.now(),
                    name,
                    day: currentDay,
                    date: currentDate,
                    shiftType,
                    workStart,
                    workEnd,
                    timeIn: currentTime,
                    timeOut: null,
                    notes: notes || '',
                    status: 'active',
                    photo: capturedPhotoData
                };

                activeSessions.push(newSession);
                localStorage.setItem('activeSessions', JSON.stringify(activeSessions));
                showNotification(`${name} berhasil absen masuk pada ${currentTime}!`, 'success');

            } else if (attendanceType === 'keluar') {
                // Find active session for this person
                const activeSession = activeSessions.find(session => 
                    session.name === name && 
                    session.date === currentDate && 
                    session.shiftType === shiftType &&
                    !session.timeOut
                );

                if (!activeSession) {
                    showNotification('Tidak ada sesi aktif untuk karyawan ini. Lakukan absen masuk terlebih dahulu!', 'warning');
                    return;
                }

                // Update session with time out
                activeSession.timeOut = currentTime;
                activeSession.status = 'completed';
                if (notes) activeSession.notes += (activeSession.notes ? ' | ' : '') + notes;

                // Calculate attendance and add to main data
                const calculations = calculateAttendance(workStart, workEnd, activeSession.timeIn, currentTime, shiftType);
                
                const completedRecord = {
                    id: Date.now(),
                    name: activeSession.name,
                    day: activeSession.day,
                    date: activeSession.date,
                    shiftType: activeSession.shiftType,
                    workStart: activeSession.workStart,
                    workEnd: activeSession.workEnd,
                    timeIn: activeSession.timeIn,
                    timeOut: currentTime,
                    notes: activeSession.notes,
                    photo: activeSession.photo,
                    ...calculations
                };

                attendanceData.push(completedRecord);
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                localStorage.setItem('activeSessions', JSON.stringify(activeSessions));

                showNotification(`${name} berhasil absen keluar pada ${currentTime}!`, 'success');
                
                // Always update all displays immediately
                renderTable();
                renderDashboard();
                updateSummary();
            }

            // Reset form
            this.reset();
            capturedPhotoData = null;
            document.getElementById('capturedPhoto').classList.add('hidden');
            renderActiveSessions();
        });

        // Render active sessions
        function renderActiveSessions() {
            const container = document.getElementById('activeSessions');
            const todayDate = new Date().toISOString().split('T')[0];
            const todaySessions = activeSessions.filter(session => 
                session.date === todayDate && !session.timeOut
            );

            if (todaySessions.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üë•</div>
                        <p>Belum ada sesi aktif hari ini</p>
                        <p class="text-sm">Lakukan absen masuk untuk memulai sesi</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = '';
            todaySessions.forEach(session => {
                const now = new Date();
                const timeIn = new Date(`${session.date}T${session.timeIn}`);
                const duration = Math.floor((now - timeIn) / 1000 / 60); // in minutes
                const durationText = minutesToHours(duration);

                const card = document.createElement('div');
                card.className = 'bg-green-50 border-2 border-green-200 rounded-lg p-4';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${session.name}</h4>
                            <p class="text-sm text-green-600 font-medium">${getShiftName(session.shiftType)}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-lg">üü¢</span>
                            <p class="text-xs text-green-600 font-medium">Aktif</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div>
                            <p class="text-gray-500">Masuk</p>
                            <p class="font-medium">${session.timeIn}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Durasi</p>
                            <p class="font-medium text-blue-600">${durationText}</p>
                        </div>
                        <div class="col-span-2">
                            <p class="text-gray-500">Jam Kerja</p>
                            <p class="font-medium">${session.workStart} - ${session.workEnd}</p>
                        </div>
                    </div>
                    
                    ${session.photo ? `
                        <div class="mt-3">
                            <p class="text-xs text-gray-500 mb-2">Foto Absensi:</p>
                            <img src="${session.photo}" alt="Foto Absensi" class="w-full h-24 object-cover rounded-lg border border-gray-200 cursor-pointer" onclick="showPhotoModal('${session.photo}')">
                        </div>
                    ` : ''}
                    
                    ${session.notes ? `
                        <div class="mt-3 pt-3 border-t border-green-100">
                            <p class="text-xs text-gray-500">Catatan:</p>
                            <p class="text-sm text-gray-700">${session.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div class="mt-3 pt-3 border-t border-green-100">
                        <button onclick="quickCheckOut('${session.name}', '${session.shiftType}')" class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded text-sm font-medium transition-colors">
                            Absen Keluar Sekarang
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Quick check out function
        function quickCheckOut(name, shiftType) {
            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5);
            const currentDate = now.toISOString().split('T')[0];

            // Find active session
            const activeSession = activeSessions.find(session => 
                session.name === name && 
                session.date === currentDate && 
                session.shiftType === shiftType &&
                !session.timeOut
            );

            if (!activeSession) {
                showNotification('Sesi tidak ditemukan!', 'error');
                return;
            }

            // Update session
            activeSession.timeOut = currentTime;
            activeSession.status = 'completed';

            // Calculate and add to main data
            const calculations = calculateAttendance(
                activeSession.workStart, 
                activeSession.workEnd, 
                activeSession.timeIn, 
                currentTime, 
                activeSession.shiftType
            );
            
            const completedRecord = {
                id: Date.now(),
                name: activeSession.name,
                day: activeSession.day,
                date: activeSession.date,
                shiftType: activeSession.shiftType,
                workStart: activeSession.workStart,
                workEnd: activeSession.workEnd,
                timeIn: activeSession.timeIn,
                timeOut: currentTime,
                notes: activeSession.notes,
                photo: activeSession.photo,
                ...calculations
            };

            attendanceData.push(completedRecord);
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
            localStorage.setItem('activeSessions', JSON.stringify(activeSessions));

            showNotification(`${name} berhasil absen keluar pada ${currentTime}!`, 'success');
            renderActiveSessions();
            
            // Always update all displays immediately
            renderTable();
            renderDashboard();
            updateSummary();
        }

        // Set tanggal hari ini sebagai default dan hari otomatis
        document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
        
        // Auto-set hari berdasarkan tanggal
        document.getElementById('attendanceDate').addEventListener('change', function() {
            const date = new Date(this.value);
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            document.getElementById('dayOfWeek').value = days[date.getDay()];
        });

        // Shift selection handler
        document.getElementById('shiftSelect').addEventListener('change', function() {
            const shift = this.value;
            const workStart = document.getElementById('workStart');
            const workEnd = document.getElementById('workEnd');
            
            const shifts = {
                'shift1': { start: '05:00', end: '13:00' },
                'shift2': { start: '07:20', end: '15:20' },
                'kantor': { start: '07:00', end: '17:00' },
                'piket1': { start: '18:00', end: '06:00' },
                'piket_pagi': { start: '07:00', end: '12:00' },
                'piket_siang': { start: '12:00', end: '17:00' }
            };
            
            if (shifts[shift]) {
                workStart.value = shifts[shift].start;
                workEnd.value = shifts[shift].end;
            }
        });

        // Edit shift selection handler
        document.getElementById('editShiftSelect').addEventListener('change', function() {
            const shift = this.value;
            const workStart = document.getElementById('editWorkStart');
            const workEnd = document.getElementById('editWorkEnd');
            
            const shifts = {
                'shift1': { start: '05:00', end: '13:00' },
                'shift2': { start: '07:20', end: '15:20' },
                'kantor': { start: '07:00', end: '17:00' },
                'piket1': { start: '18:00', end: '06:00' },
                'piket_pagi': { start: '07:00', end: '12:00' },
                'piket_siang': { start: '12:00', end: '17:00' }
            };
            
            if (shifts[shift]) {
                workStart.value = shifts[shift].start;
                workEnd.value = shifts[shift].end;
            }
        });

        // Load data saat halaman dimuat
        window.onload = function() {
            // Set hari untuk tanggal hari ini
            const today = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            document.getElementById('dayOfWeek').value = days[today.getDay()];
            
            // Load all data from localStorage
            attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
            activeSessions = JSON.parse(localStorage.getItem('activeSessions')) || [];
            isLoggedIn = JSON.parse(localStorage.getItem('isLoggedIn')) || false;
            
            // Show logout button if logged in
            if (isLoggedIn) {
                document.getElementById('logoutBtn').classList.remove('hidden');
            }
            
            // Start with real-time page
            showPage('realtime');
            
            // Ensure all displays are updated
            renderTable();
            renderDashboard();
            updateSummary();
            renderActiveSessions();
        };

        // Fungsi untuk menghitung selisih waktu dalam menit
        function getTimeDifferenceInMinutes(time1, time2) {
            const [h1, m1] = time1.split(':').map(Number);
            const [h2, m2] = time2.split(':').map(Number);
            const minutes1 = h1 * 60 + m1;
            const minutes2 = h2 * 60 + m2;
            return minutes2 - minutes1;
        }

        // Fungsi untuk mengkonversi menit ke format jam:menit
        function minutesToHours(minutes) {
            if (minutes <= 0) return '0:00';
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours}:${mins.toString().padStart(2, '0')}`;
        }

        // Fungsi untuk menghitung data kehadiran berdasarkan rumus yang diminta
        function calculateAttendance(workStart, workEnd, timeIn, timeOut, shiftType) {
            // Terlambat = Jam Masuk - Jam Kerja Mulai (jika positif)
            let lateMinutes = 0;
            
            // Handle shift piket 1 (night shift) crossing midnight
            if (shiftType === 'piket1') {
                // For night shift, if timeIn is before 12:00, it's the next day
                const workStartMinutes = timeToMinutes(workStart);
                let timeInMinutes = timeToMinutes(timeIn);
                
                // If timeIn is before noon, add 24 hours (next day)
                if (timeInMinutes < 720) { // 720 = 12:00 in minutes
                    timeInMinutes += 1440; // Add 24 hours
                }
                
                lateMinutes = Math.max(0, timeInMinutes - workStartMinutes);
            } else {
                lateMinutes = Math.max(0, getTimeDifferenceInMinutes(workStart, timeIn));
            }
            
            // Cepat Pulang = Jam Kerja Selesai - Jam Keluar (jika positif)
            let earlyLeaveMinutes = 0;
            
            if (shiftType === 'piket1') {
                // For night shift
                const workEndMinutes = timeToMinutes(workEnd) + 1440; // Next day
                let timeOutMinutes = timeToMinutes(timeOut);
                
                // If timeOut is before noon, it's the next day
                if (timeOutMinutes < 720) {
                    timeOutMinutes += 1440;
                }
                
                earlyLeaveMinutes = Math.max(0, workEndMinutes - timeOutMinutes);
            } else {
                earlyLeaveMinutes = Math.max(0, getTimeDifferenceInMinutes(timeOut, workEnd));
            }
            
            // Jam Efektif = Jam Keluar - Jam Masuk (tanpa pengurangan istirahat)
            let effectiveMinutes = 0;
            
            if (shiftType === 'piket1') {
                // For night shift
                let timeInMinutes = timeToMinutes(timeIn);
                let timeOutMinutes = timeToMinutes(timeOut);
                
                // If timeIn is before noon, add 24 hours
                if (timeInMinutes < 720) {
                    timeInMinutes += 1440;
                }
                
                // If timeOut is before noon, add 24 hours
                if (timeOutMinutes < 720) {
                    timeOutMinutes += 1440;
                }
                
                effectiveMinutes = Math.max(0, timeOutMinutes - timeInMinutes);
            } else {
                effectiveMinutes = Math.max(0, getTimeDifferenceInMinutes(timeIn, timeOut));
            }
            
            // Determine standard work hours based on shift
            let standardHours = 8 * 60; // 8 hours in minutes
            if (shiftType === 'piket_pagi' || shiftType === 'piket_siang') {
                standardHours = 5 * 60; // 5 hours for piket kantor shifts
            } else if (shiftType === 'kantor') {
                standardHours = 9 * 60; // 9 hours for office shift (10 hours - 1 hour break)
            } else if (shiftType === 'piket1') {
                standardHours = 12 * 60; // 12 hours for night shift
            }
            
            // Lembur = Jam Efektif - Standard Hours (jika jam efektif > standard)
            const overtimeMinutes = Math.max(0, effectiveMinutes - standardHours);

            // Status indicators
            const isLate = lateMinutes > 0;
            const isEarlyLeave = earlyLeaveMinutes > 0;
            const isUnderHours = effectiveMinutes < standardHours;

            return {
                late: minutesToHours(lateMinutes),
                earlyLeave: minutesToHours(earlyLeaveMinutes),
                effective: minutesToHours(effectiveMinutes),
                overtime: minutesToHours(overtimeMinutes),
                lateMinutes,
                earlyLeaveMinutes,
                effectiveMinutes,
                overtimeMinutes,
                isLate,
                isEarlyLeave,
                isUnderHours,
                shiftType,
                standardHours
            };
        }

        // Helper function to convert time to minutes
        function timeToMinutes(time) {
            const [hours, minutes] = time.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // Helper function to get shift name
        function getShiftName(shiftType) {
            const shiftNames = {
                'shift1': 'Shift 1',
                'shift2': 'Shift 2', 
                'kantor': 'Kantor',
                'piket1': 'Piket 1',
                'piket_pagi': 'Piket Pagi',
                'piket_siang': 'Piket Siang'
            };
            return shiftNames[shiftType] || 'Unknown';
        }

        // Handle form submission
        document.getElementById('attendanceForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('employeeName').value;
            const day = document.getElementById('dayOfWeek').value;
            const date = document.getElementById('attendanceDate').value;
            const shiftType = document.getElementById('shiftSelect').value;
            const workStart = document.getElementById('workStart').value;
            const workEnd = document.getElementById('workEnd').value;
            const timeIn = document.getElementById('timeIn').value;
            const timeOut = document.getElementById('timeOut').value;
            const notes = document.getElementById('notes').value;

            if (!shiftType) {
                showNotification('Pilih shift terlebih dahulu!', 'warning');
                return;
            }

            // Special validation for night shift
            if (shiftType === 'piket1') {
                // Night shift validation is more complex, skip simple time comparison
            } else {
                if (timeIn >= timeOut) {
                    showNotification('Jam keluar harus lebih besar dari jam masuk!', 'error');
                    return;
                }

                if (workStart >= workEnd) {
                    showNotification('Jam kerja selesai harus lebih besar dari jam kerja mulai!', 'error');
                    return;
                }
            }

            const calculations = calculateAttendance(workStart, workEnd, timeIn, timeOut, shiftType);
            
            const newRecord = {
                id: Date.now(),
                name,
                day,
                date,
                shiftType,
                workStart,
                workEnd,
                timeIn,
                timeOut,
                notes,
                ...calculations
            };

            attendanceData.push(newRecord);
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
            
            renderTable();
            renderDashboard();
            updateSummary();
            
            // Reset form
            this.reset();
            document.getElementById('attendanceDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('workStart').value = '07:00';
            document.getElementById('workEnd').value = '17:00';
            
            // Set hari untuk tanggal hari ini
            const today = new Date();
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            document.getElementById('dayOfWeek').value = days[today.getDay()];
            
            // Show success message
            showNotification('Data berhasil ditambahkan!', 'success');
        });

        // Render dashboard cards
        function renderDashboard() {
            const cardView = document.getElementById('cardView');
            cardView.innerHTML = '';

            if (attendanceData.length === 0) {
                cardView.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <div class="text-4xl mb-4">üìã</div>
                        <p>Belum ada data kehadiran</p>
                        <p class="text-sm">Tambahkan data kehadiran untuk melihat dashboard</p>
                    </div>
                `;
                return;
            }

            attendanceData.forEach(record => {
                const card = document.createElement('div');
                
                // Tentukan warna border berdasarkan status
                let borderColor = 'border-green-200';
                let statusIcon = '‚úÖ';
                let statusText = 'Normal';
                let statusColor = 'text-green-600';
                
                if (record.isLate) {
                    borderColor = 'border-red-200';
                    statusIcon = 'üî¥';
                    statusText = 'Terlambat';
                    statusColor = 'text-red-600';
                } else if (record.isEarlyLeave) {
                    borderColor = 'border-orange-200';
                    statusIcon = 'üü†';
                    statusText = 'Cepat Pulang';
                    statusColor = 'text-orange-600';
                } else if (record.isUnderHours) {
                    borderColor = 'border-yellow-200';
                    statusIcon = 'üü°';
                    statusText = 'Jam Kurang';
                    statusColor = 'text-yellow-600';
                }
                
                card.className = `bg-white border-2 ${borderColor} rounded-lg p-4 hover:shadow-md transition-shadow duration-200`;
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h3 class="font-semibold text-gray-900">${record.name}</h3>
                            <p class="text-sm text-gray-500">${record.day || '-'} ‚Ä¢ ${new Date(record.date).toLocaleDateString('id-ID')}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-lg">${statusIcon}</span>
                            <p class="text-xs ${statusColor} font-medium">${statusText}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div>
                            <p class="text-gray-500">Shift</p>
                            <p class="font-medium text-indigo-600">${getShiftName(record.shiftType)}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Jam Kerja</p>
                            <p class="font-medium">${record.workStart || '07:00'} - ${record.workEnd || '17:00'}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Kehadiran</p>
                            <p class="font-medium">${record.timeIn} - ${record.timeOut}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Telat</p>
                            <p class="font-medium ${record.isLate ? 'text-red-600' : 'text-green-600'}">${record.late}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Cepat Pulang</p>
                            <p class="font-medium ${record.isEarlyLeave ? 'text-orange-600' : 'text-green-600'}">${record.earlyLeave}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Jam Efektif</p>
                            <p class="font-medium ${record.isUnderHours ? 'text-yellow-600' : 'text-green-600'}">${record.effective}</p>
                        </div>
                        <div>
                            <p class="text-gray-500">Lembur</p>
                            <p class="font-medium text-blue-600">${record.overtime}</p>
                        </div>
                    </div>
                    
                    ${record.photo ? `
                        <div class="mt-3">
                            <p class="text-xs text-gray-500 mb-2">Foto Absensi:</p>
                            <img src="${record.photo}" alt="Foto Absensi" class="w-full h-24 object-cover rounded-lg border border-gray-200 cursor-pointer" onclick="showPhotoModal('${record.photo}')">
                        </div>
                    ` : ''}
                    
                    ${record.notes ? `
                        <div class="mt-3 pt-3 border-t border-gray-100">
                            <p class="text-xs text-gray-500">Catatan:</p>
                            <p class="text-sm text-gray-700">${record.notes}</p>
                        </div>
                    ` : ''}
                    
                    <div class="mt-3 pt-3 border-t border-gray-100 flex gap-2">
                        <button onclick="editRecord(${record.id})" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                            ‚úèÔ∏è Edit
                        </button>
                        <button onclick="deleteRecord(${record.id})" class="text-red-600 hover:text-red-800 text-sm font-medium">
                            üóëÔ∏è Hapus
                        </button>
                    </div>
                `;
                cardView.appendChild(card);
            });
        }

        // Toggle view between cards and table
        function toggleView(view) {
            const cardView = document.getElementById('cardView');
            const tableView = document.getElementById('tableView');
            const cardBtn = document.getElementById('cardViewBtn');
            const tableBtn = document.getElementById('tableViewBtn');
            
            if (view === 'cards') {
                cardView.style.display = 'grid';
                tableView.style.display = 'none';
                cardBtn.className = 'flex-1 sm:flex-none bg-indigo-600 text-white px-3 py-2 rounded-lg text-sm font-medium btn-responsive min-h-[44px] flex items-center justify-center';
                tableBtn.className = 'flex-1 sm:flex-none bg-gray-300 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium btn-responsive min-h-[44px] flex items-center justify-center';
            } else {
                cardView.style.display = 'none';
                tableView.style.display = 'block';
                cardBtn.className = 'flex-1 sm:flex-none bg-gray-300 text-gray-700 px-3 py-2 rounded-lg text-sm font-medium btn-responsive min-h-[44px] flex items-center justify-center';
                tableBtn.className = 'flex-1 sm:flex-none bg-indigo-600 text-white px-3 py-2 rounded-lg text-sm font-medium btn-responsive min-h-[44px] flex items-center justify-center';
            }
        }

        // Render tabel
        function renderTable() {
            const tbody = document.getElementById('attendanceTable');
            tbody.innerHTML = '';

            attendanceData.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                // Tentukan warna berdasarkan status
                const lateClass = record.isLate ? 'bg-red-100 text-red-800 font-bold' : 'text-green-600 font-medium';
                const earlyClass = record.isEarlyLeave ? 'bg-orange-100 text-orange-800 font-bold' : 'text-green-600 font-medium';
                const effectiveClass = record.isUnderHours ? 'bg-yellow-100 text-yellow-800 font-bold' : 'text-green-600 font-medium';
                
                row.innerHTML = `
                    <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${record.name}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-indigo-600 font-medium">${getShiftName(record.shiftType)}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${record.day || '-'}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${new Date(record.date).toLocaleDateString('id-ID')}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${record.workStart || '07:00'} - ${record.workEnd || '17:00'}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${record.timeIn}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${record.timeOut}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm ${lateClass} rounded px-2 py-1">${record.late}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm ${earlyClass} rounded px-2 py-1">${record.earlyLeave}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm ${effectiveClass} rounded px-2 py-1">${record.effective}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-blue-600 font-medium">${record.overtime}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${record.photo ? `<img src="${record.photo}" alt="Foto" class="w-12 h-12 object-cover rounded border cursor-pointer" onclick="showPhotoModal('${record.photo}')">` : '-'}
                    </td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${record.notes || '-'}</td>
                    <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div class="flex gap-2">
                            <button onclick="editRecord(${record.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">Edit</button>
                            <button onclick="deleteRecord(${record.id})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs font-medium transition-colors">Hapus</button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update summary
        function updateSummary() {
            if (attendanceData.length === 0) {
                document.getElementById('totalLate').textContent = '0:00';
                document.getElementById('totalEarly').textContent = '0:00';
                document.getElementById('totalEffective').textContent = '0:00';
                document.getElementById('totalOvertime').textContent = '0:00';
                return;
            }

            const totals = attendanceData.reduce((acc, record) => {
                acc.late += record.lateMinutes || 0;
                acc.earlyLeave += record.earlyLeaveMinutes || 0;
                acc.effective += record.effectiveMinutes || 0;
                acc.overtime += record.overtimeMinutes || 0;
                return acc;
            }, { late: 0, earlyLeave: 0, effective: 0, overtime: 0 });

            // Calculate averages
            const avgEffective = Math.round(totals.effective / attendanceData.length);

            document.getElementById('totalLate').textContent = minutesToHours(totals.late);
            document.getElementById('totalEarly').textContent = minutesToHours(totals.earlyLeave);
            document.getElementById('totalEffective').textContent = minutesToHours(avgEffective);
            document.getElementById('totalOvertime').textContent = minutesToHours(totals.overtime);
        }

        // Edit record
        function editRecord(id) {
            const record = attendanceData.find(r => r.id === id);
            if (!record) return;

            // Populate edit form
            document.getElementById('editId').value = record.id;
            document.getElementById('editEmployeeName').value = record.name;
            document.getElementById('editDayOfWeek').value = record.day;
            document.getElementById('editAttendanceDate').value = record.date;
            document.getElementById('editShiftSelect').value = record.shiftType;
            document.getElementById('editWorkStart').value = record.workStart;
            document.getElementById('editWorkEnd').value = record.workEnd;
            document.getElementById('editTimeIn').value = record.timeIn;
            document.getElementById('editTimeOut').value = record.timeOut;
            document.getElementById('editNotes').value = record.notes || '';

            // Show modal
            document.getElementById('editModal').classList.remove('hidden');
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editForm').reset();
        }

        // Handle edit form submission
        document.getElementById('editForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editId').value);
            const name = document.getElementById('editEmployeeName').value;
            const day = document.getElementById('editDayOfWeek').value;
            const date = document.getElementById('editAttendanceDate').value;
            const shiftType = document.getElementById('editShiftSelect').value;
            const workStart = document.getElementById('editWorkStart').value;
            const workEnd = document.getElementById('editWorkEnd').value;
            const timeIn = document.getElementById('editTimeIn').value;
            const timeOut = document.getElementById('editTimeOut').value;
            const notes = document.getElementById('editNotes').value;

            if (!shiftType) {
                showNotification('Pilih shift terlebih dahulu!', 'warning');
                return;
            }

            // Special validation for night shift
            if (shiftType === 'piket1') {
                // Night shift validation is more complex, skip simple time comparison
            } else {
                if (timeIn >= timeOut) {
                    showNotification('Jam keluar harus lebih besar dari jam masuk!', 'error');
                    return;
                }

                if (workStart >= workEnd) {
                    showNotification('Jam kerja selesai harus lebih besar dari jam kerja mulai!', 'error');
                    return;
                }
            }

            const calculations = calculateAttendance(workStart, workEnd, timeIn, timeOut, shiftType);
            
            // Find and update record
            const recordIndex = attendanceData.findIndex(r => r.id === id);
            if (recordIndex !== -1) {
                attendanceData[recordIndex] = {
                    id,
                    name,
                    day,
                    date,
                    shiftType,
                    workStart,
                    workEnd,
                    timeIn,
                    timeOut,
                    notes,
                    ...calculations
                };

                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                
                renderTable();
                renderDashboard();
                updateSummary();
                closeEditModal();
                
                showNotification('Data berhasil diperbarui!', 'success');
            }
        });

        // Delete record
        function deleteRecord(id) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                attendanceData = attendanceData.filter(record => record.id !== id);
                localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
                renderTable();
                renderDashboard();
                updateSummary();
                showNotification('Data berhasil dihapus!', 'success');
            }
        }

        // Export to CSV (Excel format)
        function exportToCSV() {
            if (attendanceData.length === 0) {
                showNotification('Tidak ada data untuk diekspor!', 'warning');
                return;
            }

            const headers = ['Nama', 'Shift', 'Hari', 'Tanggal', 'Jam Kerja', 'Jam Masuk', 'Jam Keluar', 'Telat', 'Cepat Pulang', 'Jam Efektif', 'Lembur', 'Catatan'];
            
            // Calculate totals
            const totals = attendanceData.reduce((acc, record) => {
                acc.late += record.lateMinutes || 0;
                acc.earlyLeave += record.earlyLeaveMinutes || 0;
                acc.effective += record.effectiveMinutes || 0;
                acc.overtime += record.overtimeMinutes || 0;
                return acc;
            }, { late: 0, earlyLeave: 0, effective: 0, overtime: 0 });

            const csvContent = [
                headers.join(','),
                ...attendanceData.map(record => [
                    `"${record.name}"`,
                    `"${getShiftName(record.shiftType)}"`,
                    `"${record.day || '-'}"`,
                    record.date,
                    `"${record.workStart || '07:00'} - ${record.workEnd || '17:00'}"`,
                    record.timeIn,
                    record.timeOut,
                    record.late,
                    record.earlyLeave,
                    record.effective,
                    record.overtime,
                    `"${record.notes || '-'}"`
                ].join(',')),
                '', // Empty row
                'TOTAL,,,,,,' + [
                    minutesToHours(totals.late),
                    minutesToHours(totals.earlyLeave),
                    minutesToHours(totals.effective),
                    minutesToHours(totals.overtime),
                    ''
                ].join(',')
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `data-kehadiran-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data berhasil diekspor ke Excel!', 'success');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96df4d7f90e5ea8a',t:'MTc1NDk5NDY4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
