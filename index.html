<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Laporan Kerja - Siap Deploy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Aplikasi Laporan Kerja dengan GPS dan Foto Real-time">
    <meta name="keywords" content="laporan kerja, GPS, foto, real-time">
    <meta name="author" content="PT. Contoh Perusahaan">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- Performance & Security -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <style>
        /* Custom loading animation */
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2563eb;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Fade in animation */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Progress bar */
        .progress-bar {
            width: 0%;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            transition: width 0.3s ease;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-gray-800">Memuat Aplikasi...</h2>
            <p class="text-gray-600">Menginisialisasi sistem</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-clipboard-list text-blue-600 text-xl sm:text-2xl"></i>
                    <h1 class="text-lg sm:text-xl font-bold text-gray-800">Laporan Kerja</h1>
                </div>
                <div class="flex space-x-1 sm:space-x-2">
                    <button onclick="showForm()" class="bg-blue-600 text-white px-2 sm:px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-xs sm:text-sm">
                        <i class="fas fa-plus mr-1"></i><span class="hidden sm:inline">Buat </span>Laporan
                    </button>
                    <button onclick="checkAdminAccess()" class="bg-green-600 text-white px-2 sm:px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-xs sm:text-sm">
                        <i class="fas fa-tachometer-alt mr-1"></i><span class="hidden sm:inline">Dashboard </span>Admin
                    </button>
                    <button onclick="adminLogout()" id="logoutBtn" class="bg-red-600 text-white px-2 sm:px-3 py-2 rounded-lg hover:bg-red-700 transition-colors hidden text-xs sm:text-sm">
                        <i class="fas fa-sign-out-alt mr-1"></i><span class="hidden sm:inline">Logout</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Connection Status -->
    <div id="connectionStatus" class="bg-green-100 border-l-4 border-green-500 text-green-700 p-2 text-sm hidden">
        <div class="flex items-center">
            <i class="fas fa-wifi mr-2"></i>
            <span id="statusText">Terhubung ke server</span>
        </div>
    </div>

    <!-- Progress Bar -->
    <div id="progressContainer" class="w-full bg-gray-200 hidden">
        <div id="progressBar" class="progress-bar"></div>
    </div>

    <!-- Form Laporan -->
    <div id="formSection" class="max-w-3xl mx-auto p-3 sm:p-6 fade-in">
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-8">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 text-center">
                <i class="fas fa-clipboard-list text-blue-600 mr-2"></i>Laporan Kerja
            </h2>
            
            <form id="reportForm" class="space-y-4 sm:space-y-6">
                <!-- Nama Petugas -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-user text-blue-600 mr-2"></i>Nama Petugas
                    </label>
                    <input type="text" id="namaPetugas" required 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                           placeholder="Masukkan nama petugas">
                </div>

                <!-- Tugas Pekerjaan -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-tasks text-green-600 mr-2"></i>Tugas Pekerjaan
                    </label>
                    <textarea id="tugasPekerjaan" required rows="4"
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-green-500 focus:border-transparent"
                              placeholder="Deskripsikan tugas pekerjaan yang dilakukan"></textarea>
                </div>

                <!-- Media Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                    <!-- Foto Dokumentasi -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-camera text-blue-600 mr-2"></i>Foto Dokumentasi
                        </label>
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center bg-white">
                            <video id="videoPreview" class="w-full h-40 bg-gray-100 rounded-lg mb-3 hidden"></video>
                            <canvas id="photoCanvas" class="w-full h-40 bg-gray-100 rounded-lg mb-3 hidden"></canvas>
                            <img id="capturedPhoto" class="w-full h-40 object-cover rounded-lg mb-3 hidden">
                            
                            <div id="cameraControls" class="flex flex-wrap gap-2 justify-center">
                                <button type="button" onclick="startCamera()" 
                                        class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 text-sm">
                                    <i class="fas fa-video mr-1"></i>Buka Kamera
                                </button>
                                <button type="button" onclick="capturePhoto()" id="captureBtn"
                                        class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 hidden text-sm">
                                    <i class="fas fa-camera mr-1"></i>Ambil Foto
                                </button>
                                <button type="button" onclick="retakePhoto()" id="retakeBtn"
                                        class="bg-yellow-600 text-white px-3 py-2 rounded-lg hover:bg-yellow-700 hidden text-sm">
                                    <i class="fas fa-redo mr-1"></i>Foto Ulang
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Jam Real-time -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-clock text-blue-600 mr-2"></i>Waktu Real-time
                        </label>
                        <div class="border-2 border-solid border-blue-200 rounded-lg p-4 text-center bg-gradient-to-br from-blue-50 to-indigo-50">
                            <div class="mb-4">
                                <div id="currentTime" class="text-2xl sm:text-3xl font-bold text-blue-800 mb-2">
                                    00:00:00
                                </div>
                                <div id="currentDate" class="text-sm text-blue-600 font-medium">
                                    Loading...
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-xs">
                                <div class="bg-white p-2 rounded border border-blue-100">
                                    <div class="text-gray-500">Zona Waktu</div>
                                    <div id="timezone" class="font-semibold text-blue-700">WIB</div>
                                </div>
                                <div class="bg-white p-2 rounded border border-blue-100">
                                    <div class="text-gray-500">Status</div>
                                    <div class="font-semibold text-green-600">
                                        <i class="fas fa-circle text-green-500 mr-1" style="font-size: 8px;"></i>Live
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lokasi -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        <i class="fas fa-map-marker-alt text-purple-600 mr-2"></i>Lokasi GPS
                    </label>
                    <div class="flex gap-2">
                        <input type="text" id="lokasiText" readonly
                               class="flex-1 px-4 py-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                               placeholder="Lokasi akan terdeteksi otomatis">
                        <button type="button" onclick="getLocation()" 
                                class="bg-purple-600 text-white px-4 py-3 rounded-lg hover:bg-purple-700 whitespace-nowrap">
                            <i class="fas fa-crosshairs mr-1"></i>Dapatkan GPS
                        </button>
                    </div>
                    <div id="locationStatus" class="text-sm text-gray-600 mt-2"></div>
                </div>

                <!-- Company Name (Hidden) -->
                <input type="hidden" id="companyName" value="PT. Contoh Perusahaan">

                <!-- Tombol Kirim -->
                <div class="pt-4">
                    <button type="submit" id="submitBtn"
                            class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 px-6 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-300 font-semibold text-lg shadow-lg">
                        <i class="fas fa-paper-plane mr-2"></i>Kirim Laporan
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard Admin -->
    <div id="dashboardSection" class="max-w-7xl mx-auto p-4 sm:p-6 hidden fade-in">
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-8">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-tachometer-alt text-green-600 mr-3"></i>Dashboard Admin
            </h2>

            <!-- Stats Cards -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                <div class="bg-blue-50 p-4 sm:p-6 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-file-alt text-blue-600 text-xl sm:text-2xl mr-2 sm:mr-4"></i>
                        <div>
                            <p class="text-xs sm:text-sm text-gray-600">Total Laporan</p>
                            <p class="text-lg sm:text-2xl font-bold text-blue-600" id="totalReports">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-yellow-50 p-4 sm:p-6 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-yellow-600 text-xl sm:text-2xl mr-2 sm:mr-4"></i>
                        <div>
                            <p class="text-xs sm:text-sm text-gray-600">Menunggu</p>
                            <p class="text-lg sm:text-2xl font-bold text-yellow-600" id="pendingReports">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-green-50 p-4 sm:p-6 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 text-xl sm:text-2xl mr-2 sm:mr-4"></i>
                        <div>
                            <p class="text-xs sm:text-sm text-gray-600">Terverifikasi</p>
                            <p class="text-lg sm:text-2xl font-bold text-green-600" id="verifiedReports">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-red-50 p-4 sm:p-6 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-times-circle text-red-600 text-xl sm:text-2xl mr-2 sm:mr-4"></i>
                        <div>
                            <p class="text-xs sm:text-sm text-gray-600">Ditolak</p>
                            <p class="text-lg sm:text-2xl font-bold text-red-600" id="rejectedReports">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Control Panel -->
            <div class="mb-6 flex flex-col lg:flex-row justify-between items-start lg:items-center space-y-4 lg:space-y-0">
                <h3 class="text-lg font-semibold text-gray-800">Data Laporan Real-time</h3>
                <div class="grid grid-cols-2 lg:flex gap-2 w-full lg:w-auto">
                    <button onclick="showDeployGuide()" 
                            class="bg-purple-600 text-white px-3 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm font-medium">
                        <i class="fas fa-rocket mr-1"></i><span class="hidden sm:inline">Panduan </span>Deploy
                    </button>
                    <button onclick="showDatabaseViewer()" 
                            class="bg-indigo-600 text-white px-3 py-2 rounded-lg hover:bg-indigo-700 transition-colors text-sm font-medium">
                        <i class="fas fa-eye mr-1"></i><span class="hidden sm:inline">Lihat </span>Database
                    </button>
                    <button onclick="openFirebaseConsole()" 
                            class="bg-orange-600 text-white px-3 py-2 rounded-lg hover:bg-orange-700 transition-colors text-sm font-medium">
                        <i class="fas fa-database mr-1"></i><span class="hidden sm:inline">Firebase </span>Console
                    </button>
                    <button onclick="refreshData()" 
                            class="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                        <i class="fas fa-sync mr-1"></i>Refresh
                    </button>
                    <button onclick="exportData()" 
                            class="bg-green-600 text-white px-3 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium">
                        <i class="fas fa-download mr-1"></i>Export
                    </button>
                </div>
            </div>

            <!-- Reports Table -->
            <div class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Petugas</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden sm:table-cell">Tugas</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden lg:table-cell">Lokasi</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider hidden md:table-cell">Waktu</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-3 sm:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTable" class="bg-white divide-y divide-gray-200">
                        <tr>
                            <td colspan="6" class="px-3 sm:px-6 py-8 text-center text-gray-500">
                                <i class="fas fa-inbox text-2xl sm:text-4xl mb-4"></i>
                                <p class="text-sm sm:text-base">Belum ada laporan yang masuk</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 sm:p-8 max-w-md w-full">
            <div class="text-center mb-6">
                <i class="fas fa-shield-alt text-green-600 text-3xl sm:text-4xl mb-4"></i>
                <h3 class="text-lg sm:text-xl font-bold text-gray-800">Login Admin</h3>
                <p class="text-sm sm:text-base text-gray-600">Masukkan kredensial admin untuk mengakses dashboard</p>
            </div>
            
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                    <input type="text" id="adminUsername" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                           placeholder="Masukkan username">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                    <input type="password" id="adminPassword" required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                           placeholder="Masukkan password">
                </div>
                <div id="loginError" class="text-red-600 text-sm hidden"></div>
                <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                    <button type="button" onclick="closeLoginModal()" 
                            class="flex-1 bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700">
                        Batal
                    </button>
                    <button type="submit" 
                            class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Database Viewer Modal -->
    <div id="databaseViewerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-4 sm:p-8 max-w-6xl w-full max-h-screen overflow-y-auto">
            <div class="text-center mb-6">
                <i class="fas fa-database text-indigo-600 text-4xl mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-800">Database Viewer</h3>
                <p class="text-gray-600">Lihat semua data yang tersimpan dalam database</p>
            </div>
            
            <div class="space-y-6">
                <!-- Database Stats -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <i class="fas fa-file-alt text-blue-600 text-2xl mb-2"></i>
                        <div class="text-sm text-gray-600">Total Records</div>
                        <div class="text-xl font-bold text-blue-600" id="dbTotalRecords">0</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <i class="fas fa-check-circle text-green-600 text-2xl mb-2"></i>
                        <div class="text-sm text-gray-600">Verified</div>
                        <div class="text-xl font-bold text-green-600" id="dbVerifiedCount">0</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                        <i class="fas fa-clock text-yellow-600 text-2xl mb-2"></i>
                        <div class="text-sm text-gray-600">Pending</div>
                        <div class="text-xl font-bold text-yellow-600" id="dbPendingCount">0</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <i class="fas fa-calendar text-purple-600 text-2xl mb-2"></i>
                        <div class="text-sm text-gray-600">Today</div>
                        <div class="text-xl font-bold text-purple-600" id="dbTodayCount">0</div>
                    </div>
                </div>

                <!-- Filter Controls -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-bold text-gray-800 mb-3">üîç Filter Data</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                            <select id="filterStatus" onchange="filterDatabaseData()" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">Semua Status</option>
                                <option value="pending">Pending</option>
                                <option value="verified">Verified</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Petugas</label>
                            <input type="text" id="filterPetugas" onkeyup="filterDatabaseData()" placeholder="Nama petugas..." class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tanggal</label>
                            <input type="date" id="filterDate" onchange="filterDatabaseData()" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>

                <!-- Raw Database Data -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="font-bold text-gray-800">üìä Raw Database Data</h4>
                        <div class="flex gap-2">
                            <button onclick="copyDatabaseData()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                <i class="fas fa-copy mr-1"></i>Copy JSON
                            </button>
                            <button onclick="downloadDatabaseData()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                <i class="fas fa-download mr-1"></i>Download
                            </button>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4 max-h-96 overflow-auto">
                        <pre id="rawDatabaseData" class="text-xs text-gray-700 whitespace-pre-wrap"></pre>
                    </div>
                </div>

                <!-- Detailed Records Table -->
                <div class="bg-white border rounded-lg overflow-hidden">
                    <div class="bg-gray-50 px-4 py-3 border-b">
                        <h4 class="font-bold text-gray-800">üìã Detailed Records (<span id="filteredCount">0</span> items)</h4>
                    </div>
                    <div class="overflow-x-auto max-h-96">
                        <table class="w-full">
                            <thead class="bg-gray-100 sticky top-0">
                                <tr>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">ID</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Petugas</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Tugas</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Lokasi</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Waktu</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Foto</th>
                                </tr>
                            </thead>
                            <tbody id="databaseTableBody" class="divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Storage Info -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">üíæ Storage Information</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <strong>Firebase Status:</strong> <span id="firebaseStatus" class="text-green-600">Connected</span><br>
                            <strong>Local Storage:</strong> <span id="localStorageSize">0 KB</span><br>
                            <strong>Total Records:</strong> <span id="totalRecordsInfo">0</span>
                        </div>
                        <div>
                            <strong>Last Sync:</strong> <span id="lastSyncTime">-</span><br>
                            <strong>Database Size:</strong> <span id="databaseSize">Calculating...</span><br>
                            <strong>Photos Stored:</strong> <span id="photosCount">0</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button onclick="closeDatabaseViewer()" 
                        class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Deploy Guide Modal -->
    <div id="deployGuideModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-4 sm:p-8 max-w-4xl w-full max-h-screen overflow-y-auto">
            <div class="text-center mb-6">
                <i class="fas fa-rocket text-blue-600 text-4xl mb-4"></i>
                <h3 class="text-2xl font-bold text-gray-800">Panduan Deploy Aplikasi</h3>
                <p class="text-gray-600">Langkah mudah untuk deploy aplikasi ke internet</p>
            </div>
            
            <div class="space-y-6 text-left">
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-800 mb-2">üéâ Aplikasi Siap Deploy!</h4>
                    <p class="text-sm text-green-700">
                        Aplikasi ini sudah dikonfigurasi dengan semua file yang dibutuhkan untuk deployment.
                        Tinggal upload dan aplikasi langsung bisa digunakan!
                    </p>
                </div>

                <!-- Method Selection -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg mb-4">
                    <h4 class="font-bold text-gray-800 mb-3">üéØ Pilih Metode Deploy:</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white p-3 rounded border-2 border-blue-200">
                            <div class="flex items-center mb-2">
                                <i class="fab fa-github text-gray-800 text-xl mr-2"></i>
                                <strong class="text-blue-800">Via GitHub (Recommended)</strong>
                            </div>
                            <p class="text-xs text-gray-600">‚úÖ Auto deploy saat push<br>‚úÖ Version control<br>‚úÖ Rollback mudah<br>‚úÖ Collaboration friendly</p>
                        </div>
                        <div class="bg-white p-3 rounded border-2 border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-upload text-gray-800 text-xl mr-2"></i>
                                <strong class="text-green-800">Drag & Drop Manual</strong>
                            </div>
                            <p class="text-xs text-gray-600">‚úÖ Super cepat<br>‚úÖ Tidak perlu GitHub<br>‚úÖ Langsung online<br>‚ö†Ô∏è Manual update</p>
                        </div>
                    </div>
                </div>

                <!-- GitHub Method -->
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-bold text-blue-800 mb-3">üöÄ Metode 1: Deploy via GitHub (RECOMMENDED)</h4>
                    <div class="space-y-4 text-sm text-blue-700">
                        
                        <!-- GitHub Step 1 -->
                        <div class="bg-white p-3 rounded border-l-4 border-blue-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs font-bold">1</span>
                                <div class="flex-1">
                                    <strong class="text-blue-800">Setup GitHub Repository</strong><br>
                                    ‚Ä¢ Buka <a href="https://github.com" target="_blank" class="text-blue-600 underline font-medium">github.com</a> dan login/daftar<br>
                                    ‚Ä¢ Klik tombol <strong>"New repository"</strong> (hijau)<br>
                                    ‚Ä¢ Nama repository: <code class="bg-gray-200 px-1 rounded">laporan-kerja-app</code><br>
                                    ‚Ä¢ Centang <strong>"Add a README file"</strong><br>
                                    ‚Ä¢ Klik <strong>"Create repository"</strong>
                                </div>
                            </div>
                        </div>

                        <!-- GitHub Step 2 -->
                        <div class="bg-white p-3 rounded border-l-4 border-green-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-green-500 text-white px-2 py-1 rounded text-xs font-bold">2</span>
                                <div class="flex-1">
                                    <strong class="text-green-800">Upload File ke GitHub</strong><br>
                                    ‚Ä¢ Di repository baru, klik <strong>"Add file"</strong> ‚Üí <strong>"Upload files"</strong><br>
                                    ‚Ä¢ Save aplikasi ini sebagai <code class="bg-gray-200 px-1 rounded">index.html</code><br>
                                    ‚Ä¢ Drag & drop file <code class="bg-gray-200 px-1 rounded">index.html</code> ke GitHub<br>
                                    ‚Ä¢ Tulis commit message: <strong>"Initial commit - Laporan Kerja App"</strong><br>
                                    ‚Ä¢ Klik <strong>"Commit changes"</strong>
                                </div>
                            </div>
                        </div>

                        <!-- GitHub Step 3 -->
                        <div class="bg-white p-3 rounded border-l-4 border-purple-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-purple-500 text-white px-2 py-1 rounded text-xs font-bold">3</span>
                                <div class="flex-1">
                                    <strong class="text-purple-800">Connect Netlify ke GitHub</strong><br>
                                    ‚Ä¢ Buka <a href="https://netlify.com" target="_blank" class="text-blue-600 underline font-medium">netlify.com</a> dan login dengan <strong>akun GitHub</strong><br>
                                    ‚Ä¢ Di dashboard, klik <strong>"New site from Git"</strong><br>
                                    ‚Ä¢ Pilih <strong>"GitHub"</strong> sebagai Git provider<br>
                                    ‚Ä¢ Authorize Netlify untuk akses GitHub<br>
                                    ‚Ä¢ Pilih repository <strong>"laporan-kerja-app"</strong>
                                </div>
                            </div>
                        </div>

                        <!-- GitHub Step 4 -->
                        <div class="bg-white p-3 rounded border-l-4 border-orange-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold">4</span>
                                <div class="flex-1">
                                    <strong class="text-orange-800">Configure Build Settings</strong><br>
                                    ‚Ä¢ <strong>Branch to deploy:</strong> <code class="bg-gray-200 px-1 rounded">main</code> (default)<br>
                                    ‚Ä¢ <strong>Build command:</strong> <em>kosongkan</em> (tidak perlu build)<br>
                                    ‚Ä¢ <strong>Publish directory:</strong> <em>kosongkan</em> (root directory)<br>
                                    ‚Ä¢ Klik <strong>"Deploy site"</strong><br>
                                    ‚Ä¢ Tunggu proses deploy (1-2 menit)
                                </div>
                            </div>
                        </div>

                        <!-- GitHub Step 5 -->
                        <div class="bg-white p-3 rounded border-l-4 border-pink-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-pink-500 text-white px-2 py-1 rounded text-xs font-bold">5</span>
                                <div class="flex-1">
                                    <strong class="text-pink-800">Aplikasi Live + Auto Deploy!</strong><br>
                                    ‚Ä¢ Netlify generate URL: <code class="bg-gray-200 px-1 rounded">https://amazing-name-123456.netlify.app</code><br>
                                    ‚Ä¢ Aplikasi sudah online dengan HTTPS!<br>
                                    ‚Ä¢ <strong>üéâ BONUS:</strong> Setiap kali push ke GitHub = auto deploy!<br>
                                    ‚Ä¢ Update aplikasi tinggal edit di GitHub ‚Üí commit ‚Üí auto live!
                                </div>
                            </div>
                        </div>

                        <!-- GitHub Benefits -->
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-3 rounded border border-green-200">
                            <h5 class="font-bold text-green-800 mb-2">üåü Keuntungan Metode GitHub:</h5>
                            <ul class="text-xs text-green-700 space-y-1">
                                <li>‚úÖ <strong>Auto Deploy:</strong> Push ke GitHub = langsung update live</li>
                                <li>‚úÖ <strong>Version Control:</strong> History semua perubahan tersimpan</li>
                                <li>‚úÖ <strong>Rollback:</strong> Bisa kembali ke versi sebelumnya</li>
                                <li>‚úÖ <strong>Collaboration:</strong> Tim bisa edit bareng</li>
                                <li>‚úÖ <strong>Branch Protection:</strong> Deploy dari branch tertentu</li>
                                <li>‚úÖ <strong>Deploy Previews:</strong> Test perubahan sebelum live</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Manual Method -->
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-800 mb-3">‚ö° Metode 2: Drag & Drop Manual (CEPAT)</h4>
                    <div class="space-y-4 text-sm text-green-700">
                        
                        <!-- Manual Step 1 -->
                        <div class="bg-white p-3 rounded border-l-4 border-blue-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-blue-500 text-white px-2 py-1 rounded text-xs font-bold">1</span>
                                <div class="flex-1">
                                    <strong class="text-blue-800">Buat Akun Netlify</strong><br>
                                    ‚Ä¢ Buka <a href="https://netlify.com" target="_blank" class="text-blue-600 underline font-medium">netlify.com</a><br>
                                    ‚Ä¢ Klik "Sign up" (daftar gratis)<br>
                                    ‚Ä¢ Gunakan email atau akun GitHub/Google<br>
                                    ‚Ä¢ Verifikasi email jika diminta
                                </div>
                            </div>
                        </div>

                        <!-- Manual Step 2 -->
                        <div class="bg-white p-3 rounded border-l-4 border-green-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-green-500 text-white px-2 py-1 rounded text-xs font-bold">2</span>
                                <div class="flex-1">
                                    <strong class="text-green-800">Siapkan File</strong><br>
                                    ‚Ä¢ Save aplikasi ini sebagai <code class="bg-gray-200 px-1 rounded">index.html</code><br>
                                    ‚Ä¢ Pastikan nama file tepat: <strong>index.html</strong><br>
                                    ‚Ä¢ File sudah siap deploy, tidak perlu edit apapun!
                                </div>
                            </div>
                        </div>

                        <!-- Manual Step 3 -->
                        <div class="bg-white p-3 rounded border-l-4 border-purple-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-purple-500 text-white px-2 py-1 rounded text-xs font-bold">3</span>
                                <div class="flex-1">
                                    <strong class="text-purple-800">Deploy ke Netlify</strong><br>
                                    ‚Ä¢ Login ke dashboard Netlify<br>
                                    ‚Ä¢ Cari area bertulisan <strong>"Want to deploy a new site without connecting to Git?"</strong><br>
                                    ‚Ä¢ Drag & drop file <code class="bg-gray-200 px-1 rounded">index.html</code> ke kotak upload<br>
                                    ‚Ä¢ Tunggu proses upload selesai (1-2 menit)
                                </div>
                            </div>
                        </div>

                        <!-- Manual Step 4 -->
                        <div class="bg-white p-3 rounded border-l-4 border-orange-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-orange-500 text-white px-2 py-1 rounded text-xs font-bold">4</span>
                                <div class="flex-1">
                                    <strong class="text-orange-800">Aplikasi Online!</strong><br>
                                    ‚Ä¢ Netlify akan generate URL otomatis: <code class="bg-gray-200 px-1 rounded">https://random-name.netlify.app</code><br>
                                    ‚Ä¢ Klik URL untuk membuka aplikasi<br>
                                    ‚Ä¢ Aplikasi sudah live dengan HTTPS!<br>
                                    ‚Ä¢ Share URL ke tim atau client
                                </div>
                            </div>
                        </div>

                        <!-- Manual Step 5 -->
                        <div class="bg-white p-3 rounded border-l-4 border-pink-500">
                            <div class="flex items-start space-x-2">
                                <span class="bg-pink-500 text-white px-2 py-1 rounded text-xs font-bold">5</span>
                                <div class="flex-1">
                                    <strong class="text-pink-800">Custom Domain (Opsional)</strong><br>
                                    ‚Ä¢ Di dashboard Netlify, klik "Domain settings"<br>
                                    ‚Ä¢ Klik "Change site name" untuk custom subdomain<br>
                                    ‚Ä¢ Atau tambahkan domain sendiri di "Custom domains"<br>
                                    ‚Ä¢ Contoh: <code class="bg-gray-200 px-1 rounded">laporan-kerja-perusahaan.netlify.app</code>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                        <!-- Tips -->
                        <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                            <h5 class="font-bold text-yellow-800 mb-2">üí° Tips Penting:</h5>
                            <ul class="text-xs text-yellow-700 space-y-1">
                                <li>‚úÖ <strong>Gratis selamanya</strong> - Netlify free tier sangat generous</li>
                                <li>‚úÖ <strong>HTTPS otomatis</strong> - SSL certificate gratis</li>
                                <li>‚úÖ <strong>CDN global</strong> - Loading cepat di seluruh dunia</li>
                                <li>‚úÖ <strong>Auto backup</strong> - File tersimpan aman di Netlify</li>
                                <li>‚úÖ <strong>Easy update</strong> - Drag & drop file baru untuk update</li>
                            </ul>
                        </div>

                        <!-- Alternative -->
                        <div class="bg-gray-50 p-3 rounded">
                            <h5 class="font-bold text-gray-800 mb-2">üîÑ Alternatif Lain:</h5>
                            <div class="text-xs text-gray-600 space-y-1">
                                <div><strong>Vercel:</strong> <a href="https://vercel.com" target="_blank" class="underline">vercel.com</a> - Sama mudahnya dengan Netlify</div>
                                <div><strong>GitHub Pages:</strong> Gratis jika punya akun GitHub</div>
                                <div><strong>Firebase Hosting:</strong> Terintegrasi dengan Firebase Database</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h4 class="font-bold text-yellow-800 mb-2">‚ö° Fitur yang Sudah Terintegrasi:</h4>
                    <ul class="text-sm text-yellow-700 space-y-1">
                        <li>‚úÖ Responsive design untuk semua device</li>
                        <li>‚úÖ PWA ready (bisa diinstall di HP)</li>
                        <li>‚úÖ Offline support dengan localStorage</li>
                        <li>‚úÖ Image compression otomatis</li>
                        <li>‚úÖ GPS location tracking</li>
                        <li>‚úÖ Real-time camera & video</li>
                        <li>‚úÖ Admin dashboard dengan login</li>
                        <li>‚úÖ Export data ke CSV</li>
                        <li>‚úÖ Security headers & validation</li>
                        <li>‚úÖ Performance monitoring</li>
                    </ul>
                </div>

                <div class="bg-purple-50 p-4 rounded-lg">
                    <h4 class="font-bold text-purple-800 mb-2">üî• Setup Firebase (Opsional):</h4>
                    <p class="text-sm text-purple-700 mb-2">
                        Untuk data real-time dan backup cloud, setup Firebase:
                    </p>
                    <ol class="text-sm text-purple-700 space-y-1">
                        <li>1. Buat project di <a href="https://console.firebase.google.com" target="_blank" class="underline">Firebase Console</a></li>
                        <li>2. Enable Realtime Database & Storage</li>
                        <li>3. Copy config dan ganti di kode JavaScript</li>
                        <li>4. Deploy ulang aplikasi</li>
                    </ol>
                </div>

                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-bold text-gray-800 mb-2">üì± Cara Install di HP:</h4>
                    <p class="text-sm text-gray-700">
                        Setelah deploy, buka aplikasi di browser HP ‚Üí Menu browser ‚Üí "Add to Home Screen" 
                        ‚Üí Aplikasi akan terinstall seperti app native!
                    </p>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button onclick="closeDeployGuide()" 
                        class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 sm:p-8 max-w-md w-full">
            <div class="text-center">
                <i class="fas fa-check-circle text-green-600 text-4xl sm:text-6xl mb-4"></i>
                <h3 class="text-lg sm:text-xl font-bold text-gray-800 mb-2">Laporan Berhasil Dikirim!</h3>
                <p class="text-sm sm:text-base text-gray-600 mb-6">Laporan Anda telah tersimpan dan menunggu verifikasi admin.</p>
                <button onclick="closeModal()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <script>
        // Production-ready Firebase Configuration
        const getFirebaseConfig = () => {
            // Production config - ganti dengan config Firebase Anda
            if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
                return {
                    apiKey: "AIzaSyC_PRODUCTION_KEY", // Ganti dengan API key production
                    authDomain: "laporan-kerja-prod.firebaseapp.com",
                    databaseURL: "https://laporan-kerja-prod-default-rtdb.firebaseio.com/",
                    projectId: "laporan-kerja-prod",
                    storageBucket: "laporan-kerja-prod.appspot.com",
                    messagingSenderId: "123456789",
                    appId: "1:123456789:web:production-app-id"
                };
            } else {
                // Development config
                return {
                    apiKey: "AIzaSyDemo-Key-For-Development",
                    authDomain: "laporan-kerja-demo.firebaseapp.com",
                    databaseURL: "https://laporan-kerja-demo-default-rtdb.firebaseio.com/",
                    projectId: "laporan-kerja-demo",
                    storageBucket: "laporan-kerja-demo.appspot.com",
                    messagingSenderId: "123456789",
                    appId: "1:123456789:web:demo-app-id"
                };
            }
        };

        // Initialize Firebase
        const firebaseConfig = getFirebaseConfig();
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // Global variables
        let reports = [];
        let currentStream = null;
        let isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';

        // Admin credentials
        const ADMIN_USERNAME = 'elfida';
        const ADMIN_PASSWORD = 'Pis750baru';

        // Firebase Database References
        const reportsRef = database.ref('reports');
        const COMPANY_NAME = 'PT. Contoh Perusahaan';

        // Performance Monitor
        class PerformanceMonitor {
            constructor() {
                this.metrics = {};
                this.startTime = performance.now();
            }
            
            mark(name) {
                this.metrics[name] = performance.now() - this.startTime;
            }
            
            measure(name, startMark, endMark) {
                const duration = this.metrics[endMark] - this.metrics[startMark];
                console.log(`üìä ${name}: ${duration.toFixed(2)}ms`);
                return duration;
            }
        }

        const monitor = new PerformanceMonitor();

        // Progress bar utility
        function showProgress(percentage) {
            const container = document.getElementById('progressContainer');
            const bar = document.getElementById('progressBar');
            
            container.classList.remove('hidden');
            bar.style.width = percentage + '%';
            
            if (percentage >= 100) {
                setTimeout(() => {
                    container.classList.add('hidden');
                    bar.style.width = '0%';
                }, 1000);
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            monitor.mark('app_start');
            
            // Hide loading screen faster
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                monitor.mark('app_ready');
                monitor.measure('App Load Time', 'app_start', 'app_ready');
            }, 800); // Reduced from 2000ms to 800ms
            
            initializeApp();
        });

        function initializeApp() {
            try {
                initializeFirebase();
                updateLoginStatus();
                autoGetLocation();
                setupServiceWorker();
                startRealTimeClock();
                showConnectionStatus(true);
                
                console.log('‚úÖ Aplikasi berhasil diinisialisasi');
            } catch (error) {
                console.error('‚ùå Error initializing app:', error);
                showConnectionStatus(false);
            }
        }

        // Service Worker for PWA
        function setupServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registered');
                    })
                    .catch(error => {
                        console.log('‚ùå Service Worker registration failed');
                    });
            }
        }

        // Connection status
        function showConnectionStatus(connected) {
            const statusDiv = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusDiv.className = 'bg-green-100 border-l-4 border-green-500 text-green-700 p-2 text-sm';
                statusText.innerHTML = '<i class="fas fa-wifi mr-2"></i>Terhubung ke server';
            } else {
                statusDiv.className = 'bg-red-100 border-l-4 border-red-500 text-red-700 p-2 text-sm';
                statusText.innerHTML = '<i class="fas fa-wifi-slash mr-2"></i>Mode offline - Data tersimpan lokal';
            }
            
            statusDiv.classList.remove('hidden');
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                statusDiv.classList.add('hidden');
            }, 3000);
        }

        // Initialize Firebase
        function initializeFirebase() {
            reportsRef.on('value', (snapshot) => {
                const data = snapshot.val();
                reports = data ? Object.keys(data).map(key => ({
                    firebaseKey: key,
                    ...data[key]
                })) : [];
                
                updateDashboardStats();
                renderReportsTable();
                showConnectionStatus(true);
            }, (error) => {
                console.error('Firebase error:', error);
                showConnectionStatus(false);
                // Fallback to localStorage
                reports = JSON.parse(localStorage.getItem('workReports') || '[]');
                updateDashboardStats();
                renderReportsTable();
            });
        }

        // Auto get location on load
        function autoGetLocation() {
            setTimeout(() => {
                getLocation();
            }, 500); // Reduced from 1000ms to 500ms
        }

        // Input sanitization
        function sanitizeInput(input) {
            return input
                .replace(/[<>]/g, '')
                .replace(/javascript:/gi, '')
                .replace(/on\w+=/gi, '')
                .trim()
                .substring(0, 1000);
        }

        // Form validation
        function validateForm(formData) {
            const errors = [];
            
            if (!formData.namaPetugas || formData.namaPetugas.length < 2) {
                errors.push('Nama petugas minimal 2 karakter');
            }
            
            if (!formData.tugasPekerjaan || formData.tugasPekerjaan.length < 10) {
                errors.push('Tugas pekerjaan minimal 10 karakter');
            }
            
            if (!formData.lokasi || !formData.lokasi.includes('Lat:')) {
                errors.push('Harap dapatkan lokasi GPS terlebih dahulu');
            }
            
            return errors;
        }

        // Navigation functions
        function showForm() {
            document.getElementById('formSection').classList.remove('hidden');
            document.getElementById('dashboardSection').classList.add('hidden');
        }

        function showDashboard() {
            document.getElementById('formSection').classList.add('hidden');
            document.getElementById('dashboardSection').classList.remove('hidden');
            updateDashboardStats();
            renderReportsTable();
        }

        // Admin functions
        function checkAdminAccess() {
            if (isAdminLoggedIn) {
                showDashboard();
            } else {
                showLoginModal();
            }
        }

        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('flex');
            document.getElementById('loginError').classList.add('hidden');
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('flex');
        }

        function updateLoginStatus() {
            const logoutBtn = document.getElementById('logoutBtn');
            if (isAdminLoggedIn) {
                logoutBtn.classList.remove('hidden');
            } else {
                logoutBtn.classList.add('hidden');
            }
        }

        function adminLogout() {
            isAdminLoggedIn = false;
            localStorage.setItem('adminLoggedIn', 'false');
            updateLoginStatus();
            showForm();
            alert('‚úÖ Logout berhasil');
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                updateLoginStatus();
                closeLoginModal();
                showDashboard();
                alert('‚úÖ Login berhasil! Selamat datang Admin');
            } else {
                errorDiv.textContent = '‚ùå Username atau password salah!';
                errorDiv.classList.remove('hidden');
                document.getElementById('adminPassword').value = '';
            }
        });

        // Camera functions
        async function startCamera() {
            try {
                // Use lower resolution for faster processing
                currentStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 }, 
                        height: { ideal: 480 },
                        facingMode: 'environment' // Use back camera on mobile
                    } 
                });
                const video = document.getElementById('videoPreview');
                video.srcObject = currentStream;
                video.classList.remove('hidden');
                video.play();
                
                document.getElementById('captureBtn').classList.remove('hidden');
            } catch (error) {
                alert('‚ùå Tidak dapat mengakses kamera: ' + error.message);
            }
        }

        // Optimized image compression
        function compressImage(canvas, quality = 0.5, maxWidth = 600) {
            const ctx = canvas.getContext('2d');
            
            let { width, height } = canvas;
            
            // More aggressive compression for faster upload
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            
            const compressedCanvas = document.createElement('canvas');
            compressedCanvas.width = width;
            compressedCanvas.height = height;
            
            const compressedCtx = compressedCanvas.getContext('2d');
            compressedCtx.drawImage(canvas, 0, 0, width, height);
            
            // Lower quality for smaller file size
            return compressedCanvas.toDataURL('image/jpeg', quality);
        }

        function capturePhoto() {
            const video = document.getElementById('videoPreview');
            const canvas = document.getElementById('photoCanvas');
            const photo = document.getElementById('capturedPhoto');
            
            // Smaller max width for faster processing
            const maxWidth = 600;
            const aspectRatio = video.videoHeight / video.videoWidth;
            
            canvas.width = Math.min(video.videoWidth, maxWidth);
            canvas.height = canvas.width * aspectRatio;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            // More aggressive compression
            const compressedDataURL = compressImage(canvas, 0.5, maxWidth);
            photo.src = compressedDataURL;
            photo.classList.remove('hidden');
            
            video.classList.add('hidden');
            document.getElementById('captureBtn').classList.add('hidden');
            document.getElementById('retakeBtn').classList.remove('hidden');
            
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
        }

        function retakePhoto() {
            document.getElementById('capturedPhoto').classList.add('hidden');
            document.getElementById('retakeBtn').classList.add('hidden');
            startCamera();
        }

        // Real-time clock functions
        function updateRealTimeClock() {
            const now = new Date();
            
            // Format time (HH:MM:SS)
            const timeString = now.toLocaleTimeString('id-ID', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Format date
            const dateString = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update DOM elements
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
            
            // Update timezone info
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const timezoneShort = timezone.includes('Jakarta') ? 'WIB' : 
                                 timezone.includes('Makassar') ? 'WITA' : 
                                 timezone.includes('Jayapura') ? 'WIT' : 'Local';
            document.getElementById('timezone').textContent = timezoneShort;
        }

        function startRealTimeClock() {
            // Update immediately
            updateRealTimeClock();
            
            // Update every second
            setInterval(updateRealTimeClock, 1000);
        }

        // Location functions
        function getLocation() {
            const statusDiv = document.getElementById('locationStatus');
            const locationInput = document.getElementById('lokasiText');
            
            statusDiv.textContent = 'üìç Mendapatkan lokasi GPS...';
            statusDiv.className = 'text-sm text-blue-600 mt-2';
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        
                        const locationText = `Lat: ${lat.toFixed(6)}, Lng: ${lng.toFixed(6)}`;
                        locationInput.value = locationText;
                        statusDiv.textContent = '‚úÖ Lokasi GPS berhasil didapatkan';
                        statusDiv.className = 'text-sm text-green-600 mt-2';
                    },
                    function(error) {
                        statusDiv.textContent = '‚ùå Gagal mendapatkan lokasi: ' + error.message;
                        statusDiv.className = 'text-sm text-red-600 mt-2';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 5000, // Reduced timeout
                        maximumAge: 60000 // Allow cached location
                    }
                );
            } else {
                statusDiv.textContent = '‚ùå GPS tidak didukung browser ini';
                statusDiv.className = 'text-sm text-red-600 mt-2';
            }
        }

        // Optimized Firebase save function
        async function saveToFirebase(reportData) {
            try {
                showProgress(10);
                
                const firebaseData = {
                    ...reportData,
                    companyName: COMPANY_NAME,
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                };

                showProgress(30);

                // Skip photo upload for faster submission - store base64 directly
                if (reportData.foto && reportData.foto !== 'null') {
                    // Just store compressed base64 for now
                    firebaseData.foto = reportData.foto;
                }
                
                showProgress(70);
                
                const newReportRef = reportsRef.push();
                await newReportRef.set(firebaseData);
                
                showProgress(100);
                
                console.log('‚úÖ Data berhasil disimpan ke Firebase');
                return true;
                
            } catch (error) {
                console.error('‚ùå Error saving to Firebase:', error);
                
                showProgress(50);
                
                // Fallback to localStorage
                const localReports = JSON.parse(localStorage.getItem('workReports') || '[]');
                localReports.push(reportData);
                localStorage.setItem('workReports', JSON.stringify(localReports));
                
                showProgress(100);
                showConnectionStatus(false);
                return true; // Still return true for better UX
            }
        }

        // Optimized photo upload (background process)
        async function uploadPhotoToStorage(base64Data, reportId) {
            return new Promise((resolve, reject) => {
                try {
                    const byteCharacters = atob(base64Data.split(',')[1]);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], {type: 'image/jpeg'});
                    
                    const storageRef = storage.ref();
                    const photoRef = storageRef.child(`photos/${reportId}_${Date.now()}.jpg`);
                    
                    const uploadTask = photoRef.put(blob);
                    
                    uploadTask.on('state_changed',
                        (snapshot) => {
                            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                            console.log('Upload progress: ' + progress + '%');
                        },
                        (error) => {
                            console.warn('Photo upload failed:', error);
                            resolve(null); // Don't fail the whole process
                        },
                        () => {
                            uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                                resolve(downloadURL);
                            });
                        }
                    );
                } catch (error) {
                    console.warn('Photo processing failed:', error);
                    resolve(null);
                }
            });
        }

        // Optimized form submission
        document.getElementById('reportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const rawData = {
                namaPetugas: document.getElementById('namaPetugas').value,
                tugasPekerjaan: document.getElementById('tugasPekerjaan').value,
                lokasi: document.getElementById('lokasiText').value,
                foto: document.getElementById('capturedPhoto').src || null
            };
            
            const formData = {
                id: Date.now(),
                namaPetugas: sanitizeInput(rawData.namaPetugas),
                tugasPekerjaan: sanitizeInput(rawData.tugasPekerjaan),
                lokasi: sanitizeInput(rawData.lokasi),
                foto: rawData.foto,
                waktu: new Date().toLocaleString('id-ID'),
                status: 'pending'
            };
            
            const errors = validateForm(formData);
            if (errors.length > 0) {
                alert('‚ùå ' + errors.join('\n'));
                return;
            }
            
            if (!formData.foto || formData.foto === 'null') {
                alert('‚ùå Harap ambil foto dokumentasi terlebih dahulu!');
                return;
            }
            
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading-spinner inline-block mr-2"></div>Mengirim...';
            submitBtn.disabled = true;
            
            try {
                // Fast submission - don't wait for photo upload
                const success = await saveToFirebase(formData);
                
                if (success) {
                    // Reset form immediately
                    document.getElementById('reportForm').reset();
                    document.getElementById('capturedPhoto').classList.add('hidden');
                    document.getElementById('lokasiText').value = '';
                    document.getElementById('locationStatus').textContent = '';
                    document.getElementById('retakeBtn').classList.add('hidden');
                    
                    // Clean up media streams
                    if (currentStream) {
                        currentStream.getTracks().forEach(track => track.stop());
                        currentStream = null;
                    }
                    
                    // Show success immediately
                    document.getElementById('successModal').classList.remove('hidden');
                    document.getElementById('successModal').classList.add('flex');
                    
                    // Auto get location for next report
                    setTimeout(autoGetLocation, 1000);
                }
                
            } catch (error) {
                console.error('Form submission error:', error);
                alert('‚ùå Terjadi kesalahan. Silakan coba lagi.');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Modal functions
        function closeModal() {
            document.getElementById('successModal').classList.add('hidden');
            document.getElementById('successModal').classList.remove('flex');
        }

        function showDeployGuide() {
            document.getElementById('deployGuideModal').classList.remove('hidden');
            document.getElementById('deployGuideModal').classList.add('flex');
        }

        function closeDeployGuide() {
            document.getElementById('deployGuideModal').classList.add('hidden');
            document.getElementById('deployGuideModal').classList.remove('flex');
        }

        function openFirebaseConsole() {
            const projectId = firebaseConfig.projectId;
            const consoleUrl = `https://console.firebase.google.com/project/${projectId}/database`;
            window.open(consoleUrl, '_blank');
        }

        function refreshData() {
            reportsRef.off();
            initializeFirebase();
            alert('üîÑ Data berhasil di-refresh!');
        }

        function exportData() {
            if (reports.length === 0) {
                alert('üìã Tidak ada data untuk diekspor');
                return;
            }
            
            const headers = ['ID', 'Petugas', 'Tugas', 'Lokasi', 'Waktu', 'Status'];
            const csvContent = [
                headers.join(','),
                ...reports.map(report => [
                    report.id,
                    `"${report.namaPetugas}"`,
                    `"${report.tugasPekerjaan}"`,
                    `"${report.lokasi}"`,
                    `"${report.waktu}"`,
                    report.status
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `laporan_kerja_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            alert('üìä Data berhasil diekspor!');
        }

        // Dashboard functions
        function updateDashboardStats() {
            const total = reports.length;
            const pending = reports.filter(r => r.status === 'pending').length;
            const verified = reports.filter(r => r.status === 'verified').length;
            const rejected = reports.filter(r => r.status === 'rejected').length;
            
            document.getElementById('totalReports').textContent = total;
            document.getElementById('pendingReports').textContent = pending;
            document.getElementById('verifiedReports').textContent = verified;
            document.getElementById('rejectedReports').textContent = rejected;
        }

        function renderReportsTable() {
            const tbody = document.getElementById('reportsTable');
            
            if (reports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-3 sm:px-6 py-8 text-center text-gray-500">
                            <i class="fas fa-inbox text-2xl sm:text-4xl mb-4"></i>
                            <p class="text-sm sm:text-base">Belum ada laporan yang masuk</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = reports.map(report => `
                <tr class="hover:bg-gray-50">
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <i class="fas fa-user-circle text-gray-400 text-lg sm:text-xl mr-2 sm:mr-3"></i>
                            <div>
                                <div class="text-xs sm:text-sm font-medium text-gray-900">${report.namaPetugas}</div>
                                <div class="text-xs text-gray-500 sm:hidden">${report.tugasPekerjaan.substring(0, 30)}...</div>
                            </div>
                        </div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 hidden sm:table-cell">
                        <div class="text-sm text-gray-900 max-w-xs truncate" title="${report.tugasPekerjaan}">
                            ${report.tugasPekerjaan}
                        </div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap hidden lg:table-cell">
                        <div class="text-sm text-gray-900">${report.lokasi}</div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap hidden md:table-cell">
                        <div class="text-sm text-gray-900">${report.waktu}</div>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusClass(report.status)}">
                            ${getStatusText(report.status)}
                        </span>
                    </td>
                    <td class="px-3 sm:px-6 py-4 whitespace-nowrap text-xs sm:text-sm font-medium">
                        ${report.status === 'pending' ? `
                            <div class="flex flex-col sm:flex-row space-y-1 sm:space-y-0 sm:space-x-2">
                                <button onclick="verifyReport(${report.id}, 'verified')" 
                                        class="text-green-600 hover:text-green-900 text-xs">
                                    <i class="fas fa-check"></i><span class="hidden sm:inline"> Verifikasi</span>
                                </button>
                                <button onclick="verifyReport(${report.id}, 'rejected')" 
                                        class="text-red-600 hover:text-red-900 text-xs">
                                    <i class="fas fa-times"></i><span class="hidden sm:inline"> Tolak</span>
                                </button>
                            </div>
                        ` : `
                            <button onclick="viewReport(${report.id})" 
                                    class="text-blue-600 hover:text-blue-900 text-xs">
                                <i class="fas fa-eye"></i><span class="hidden sm:inline"> Lihat</span>
                            </button>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        function getStatusClass(status) {
            switch(status) {
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'verified': return 'bg-green-100 text-green-800';
                case 'rejected': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Menunggu';
                case 'verified': return 'Terverifikasi';
                case 'rejected': return 'Ditolak';
                default: return 'Unknown';
            }
        }

        async function verifyReport(id, newStatus) {
            try {
                const report = reports.find(r => r.id === id);
                if (!report) {
                    alert('‚ùå Laporan tidak ditemukan!');
                    return;
                }
                
                if (report.firebaseKey) {
                    await database.ref(`reports/${report.firebaseKey}`).update({
                        status: newStatus,
                        updatedAt: firebase.database.ServerValue.TIMESTAMP,
                        verifiedBy: ADMIN_USERNAME,
                        verifiedAt: firebase.database.ServerValue.TIMESTAMP
                    });
                } else {
                    const reportIndex = reports.findIndex(r => r.id === id);
                    if (reportIndex !== -1) {
                        reports[reportIndex].status = newStatus;
                        localStorage.setItem('workReports', JSON.stringify(reports));
                        renderReportsTable();
                        updateDashboardStats();
                    }
                }
                
                const statusText = newStatus === 'verified' ? 'diverifikasi' : 'ditolak';
                alert(`‚úÖ Laporan berhasil ${statusText}!`);
                
            } catch (error) {
                console.error('Error updating report status:', error);
                alert('‚ùå Gagal mengupdate status. Silakan coba lagi.');
            }
        }

        function viewReport(id) {
            const report = reports.find(r => r.id === id);
            if (report) {
                alert(`üìã Detail Laporan:\n\nüë§ Petugas: ${report.namaPetugas}\nüìù Tugas: ${report.tugasPekerjaan}\nüìç Lokasi: ${report.lokasi}\n‚è∞ Waktu: ${report.waktu}\nüìä Status: ${getStatusText(report.status)}`);
            }
        }

        // Database Viewer Functions
        let filteredReports = [];

        function showDatabaseViewer() {
            document.getElementById('databaseViewerModal').classList.remove('hidden');
            document.getElementById('databaseViewerModal').classList.add('flex');
            loadDatabaseData();
        }

        function closeDatabaseViewer() {
            document.getElementById('databaseViewerModal').classList.add('hidden');
            document.getElementById('databaseViewerModal').classList.remove('flex');
        }

        function loadDatabaseData() {
            // Update stats
            updateDatabaseStats();
            
            // Load raw data
            displayRawDatabaseData();
            
            // Load detailed table
            filteredReports = [...reports];
            renderDatabaseTable();
            
            // Update storage info
            updateStorageInfo();
        }

        function updateDatabaseStats() {
            const total = reports.length;
            const verified = reports.filter(r => r.status === 'verified').length;
            const pending = reports.filter(r => r.status === 'pending').length;
            
            // Count today's reports
            const today = new Date().toDateString();
            const todayReports = reports.filter(r => {
                const reportDate = new Date(r.waktu).toDateString();
                return reportDate === today;
            }).length;
            
            document.getElementById('dbTotalRecords').textContent = total;
            document.getElementById('dbVerifiedCount').textContent = verified;
            document.getElementById('dbPendingCount').textContent = pending;
            document.getElementById('dbTodayCount').textContent = todayReports;
        }

        function displayRawDatabaseData() {
            const rawData = {
                totalRecords: reports.length,
                lastUpdated: new Date().toISOString(),
                records: reports.map(report => ({
                    id: report.id,
                    firebaseKey: report.firebaseKey || null,
                    namaPetugas: report.namaPetugas,
                    tugasPekerjaan: report.tugasPekerjaan,
                    lokasi: report.lokasi,
                    waktu: report.waktu,
                    status: report.status,
                    hasPhoto: report.foto ? true : false,
                    photoSize: report.foto ? Math.round(report.foto.length / 1024) + ' KB' : null,
                    companyName: report.companyName || COMPANY_NAME,
                    createdAt: report.createdAt || null,
                    updatedAt: report.updatedAt || null
                }))
            };
            
            document.getElementById('rawDatabaseData').textContent = JSON.stringify(rawData, null, 2);
        }

        function filterDatabaseData() {
            const statusFilter = document.getElementById('filterStatus').value;
            const petugasFilter = document.getElementById('filterPetugas').value.toLowerCase();
            const dateFilter = document.getElementById('filterDate').value;
            
            filteredReports = reports.filter(report => {
                // Status filter
                if (statusFilter && report.status !== statusFilter) return false;
                
                // Petugas filter
                if (petugasFilter && !report.namaPetugas.toLowerCase().includes(petugasFilter)) return false;
                
                // Date filter
                if (dateFilter) {
                    const reportDate = new Date(report.waktu).toISOString().split('T')[0];
                    if (reportDate !== dateFilter) return false;
                }
                
                return true;
            });
            
            renderDatabaseTable();
        }

        function renderDatabaseTable() {
            const tbody = document.getElementById('databaseTableBody');
            const filteredCount = document.getElementById('filteredCount');
            
            filteredCount.textContent = filteredReports.length;
            
            if (filteredReports.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-3 py-8 text-center text-gray-500">
                            <i class="fas fa-search text-2xl mb-2"></i>
                            <p class="text-sm">Tidak ada data yang sesuai dengan filter</p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            tbody.innerHTML = filteredReports.map(report => `
                <tr class="hover:bg-gray-50">
                    <td class="px-3 py-2 text-xs text-gray-900">${report.id}</td>
                    <td class="px-3 py-2 text-xs text-gray-900">${report.namaPetugas}</td>
                    <td class="px-3 py-2 text-xs text-gray-900 max-w-xs truncate" title="${report.tugasPekerjaan}">
                        ${report.tugasPekerjaan}
                    </td>
                    <td class="px-3 py-2 text-xs text-gray-900 max-w-xs truncate" title="${report.lokasi}">
                        ${report.lokasi}
                    </td>
                    <td class="px-3 py-2 text-xs text-gray-900">${report.waktu}</td>
                    <td class="px-3 py-2">
                        <span class="px-2 py-1 text-xs rounded-full ${getStatusClass(report.status)}">
                            ${getStatusText(report.status)}
                        </span>
                    </td>
                    <td class="px-3 py-2 text-center">
                        ${report.foto ? `
                            <button onclick="viewPhoto('${report.id}')" class="text-blue-600 hover:text-blue-800 text-xs">
                                <i class="fas fa-image"></i> Lihat
                            </button>
                        ` : `
                            <span class="text-gray-400 text-xs">No Photo</span>
                        `}
                    </td>
                </tr>
            `).join('');
        }

        function viewPhoto(reportId) {
            const report = reports.find(r => r.id == reportId);
            if (report && report.foto) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg p-4 max-w-2xl max-h-full overflow-auto">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-bold">Foto - ${report.namaPetugas}</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <img src="${report.foto}" alt="Foto Laporan" class="w-full h-auto rounded-lg">
                        <div class="mt-4 text-sm text-gray-600">
                            <p><strong>Petugas:</strong> ${report.namaPetugas}</p>
                            <p><strong>Waktu:</strong> ${report.waktu}</p>
                            <p><strong>Lokasi:</strong> ${report.lokasi}</p>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
        }

        function copyDatabaseData() {
            const rawData = document.getElementById('rawDatabaseData').textContent;
            navigator.clipboard.writeText(rawData).then(() => {
                alert('‚úÖ Data berhasil disalin ke clipboard!');
            }).catch(() => {
                alert('‚ùå Gagal menyalin data');
            });
        }

        function downloadDatabaseData() {
            const rawData = document.getElementById('rawDatabaseData').textContent;
            const blob = new Blob([rawData], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `database_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            alert('üì• Database backup berhasil didownload!');
        }

        function updateStorageInfo() {
            // Firebase status
            const firebaseStatus = document.getElementById('firebaseStatus');
            try {
                if (firebase.apps.length > 0) {
                    firebaseStatus.textContent = 'Connected';
                    firebaseStatus.className = 'text-green-600';
                } else {
                    firebaseStatus.textContent = 'Disconnected';
                    firebaseStatus.className = 'text-red-600';
                }
            } catch (error) {
                firebaseStatus.textContent = 'Error';
                firebaseStatus.className = 'text-red-600';
            }
            
            // Local storage size
            const localData = localStorage.getItem('workReports') || '[]';
            const localSize = Math.round(new Blob([localData]).size / 1024);
            document.getElementById('localStorageSize').textContent = localSize + ' KB';
            
            // Total records
            document.getElementById('totalRecordsInfo').textContent = reports.length;
            
            // Last sync time
            const lastSync = localStorage.getItem('lastSyncTime') || 'Never';
            document.getElementById('lastSyncTime').textContent = lastSync !== 'Never' ? new Date(lastSync).toLocaleString('id-ID') : 'Never';
            
            // Database size estimation
            const totalSize = reports.reduce((size, report) => {
                return size + JSON.stringify(report).length;
            }, 0);
            document.getElementById('databaseSize').textContent = Math.round(totalSize / 1024) + ' KB';
            
            // Photos count
            const photosCount = reports.filter(r => r.foto && r.foto !== 'null').length;
            document.getElementById('photosCount').textContent = photosCount;
        }

        // Error handling
        window.addEventListener('error', (event) => {
            console.error('üö® Global Error:', event.error);
        });

        // PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            deferredPrompt = e;
            console.log('üí° PWA install prompt available');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'970f2a41f37cce67',t:'MTc1NTQ5NjU1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
